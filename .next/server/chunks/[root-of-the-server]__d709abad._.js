module.exports=[95,e=>e.a(async(t,a)=>{try{let t=await e.y("axios-71350672325c4217");e.n(t),a()}catch(e){a(e)}},!0),406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},2734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},8307,(e,t,a)=>{t.exports=e.x("dotenv-629bad04a3c55d9b",()=>require("dotenv-629bad04a3c55d9b"))},8388,e=>{"use strict";e.i(8307).default.config();let t={projectId:("prod"===process.env.ENV?process.env.KONTENT_PROD_PROJECT_ID:process.env.KONTENT_DEV_PROJECT_ID)||"",apiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_MANAGEMENT_API_KEY:process.env.KONTENT_DEV_MANAGEMENT_API_KEY)||"",deliveryApiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_API_KEY:process.env.KONTENT_DEV_DELIVERY_API_KEY)||"",baseUrl:("prod"===process.env.ENV?process.env.KONTENT_PROD_BASE_URL:process.env.KONTENT_DEV_BASE_URL)||"",_DELIVERY_BASE_URL:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_BASE_URL:process.env.KONTENT_DEV_DELIVERY_BASE_URL)||"https://deliver.kontent.ai",contentTypeCodename:process.env.CONTENT_TYPE_CODENAME||""};function a(){return e.r(2734).appendFileSync("debug.txt",`Using config: ${JSON.stringify(t)}
`),t}e.s(["default",()=>a])},2806,e=>e.a(async(t,a)=>{try{let t=await e.y("formidable-0ebd3ffa9f735e08");e.n(t),a()}catch(e){a(e)}},!0),9934,(e,t,a)=>{t.exports=e.x("csv-parser-9a4206f3d64c41af",()=>require("csv-parser-9a4206f3d64c41af"))},9170,e=>e.a(async(t,a)=>{try{var r=e.i(2734),n=e.i(9934),o=e.i(95),i=e.i(8307),s=e.i(8388),d=t([o]);[o]=d.then?(await d)():d,i.default.config();let w=process.env.KONTENT_DEV_PROJECT_ID||"",b=process.env.KONTENT_PROD_PROJECT_ID||"",_=(0,s.default)(),N={default:{codename:"default",id:"00000000-0000-0000-0000-000000000000"},"de-DE":{codename:"de-DE",id:"79228548-6576-5a60-acad-53360bf23687"},"ja-JP":{codename:"ja-JP",id:"4e8fa49a-27d3-44a7-8135-3dc21008ddd1"},"ko-KR":{codename:"ko-KR",id:"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812"},"zh-HK":{codename:"zh-HK",id:"e832b221-cbe7-442a-8edf-98a7ac7afac6"},"zh-TW":{codename:"zh-TW",id:"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed"},"ar-AE":{codename:"ar-AE",id:"3dc9c67d-95d8-4594-890d-70f98c615fbd"},"es-MX":{codename:"es-MX",id:"0814121f-7011-4361-b7bd-cebd74fe4cd9"}};async function l(e,t){try{console.info(`${_.baseUrl}/${_.projectId}/items/codename/${e}/variants/codename/${t}`);let a=await o.default.get(`${_.baseUrl}/${_.projectId}/items/codename/${e}/variants/codename/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.debug(`Found language variant for language ${t} of content item ${e}. Response: ${JSON.stringify(a.data)}`),a.data}catch(a){if(a.response?.status===404)return console.debug(`Language variant for language ${t} of content item ${e} not found. This is expected if the variant does not exist.`),null;throw console.error(`Error finding language variant for language ${t} of content item ${e}: ${a}`),a}}async function c(e,t){try{console.debug(`Creating new version of language variant for language ${t} of item ${e}`);let a=await o.default.put(`${_.baseUrl}/${_.projectId}/items/${e}/variants/codename/${t}/new-version`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Created new version of language variant for language ${t} of item ${e}`),a.data}catch(a){throw console.error(`Error creating new version of language variant for language ${t} of item ${e}: ${a}`),a}}async function u(e,t,a){try{let r=N[t];console.debug(`Updating language variant. ${_.baseUrl}/${_.projectId}/items/${e}/variants/${r?.id}`);let n={elements:a};console.info(`Updating language variant for language ${t} of item ${e} with elements: ${JSON.stringify(n)}`);let i=await o.default.put(`${_.baseUrl}/${_.projectId}/items/${e}/variants/${r?.id}`,n,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Updated language variant for language ${t} of item ${e}`),i.data}catch(a){throw console.error(`Error updating language variant for language ${t} of item ${e}: ${a}`),a}}async function p(e){try{let t=await o.default.get(`${_.baseUrl}/${_.projectId}/items/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Found content item with codename ${e} and id: ${t.data.id}`),t.data}catch(t){throw console.error(`Error finding content item with codename ${e}: ${t}`),t}}async function f(e,t){try{let a=await o.default.post(`${_.baseUrl}/${_.projectId}/items`,{name:e,codename:t,type:{codename:_.contentTypeCodename}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Created content item ${t} with id: ${a.data.id}`),a.data}catch(e){throw o.default.isAxiosError(e)?console.error(`Error creating content item ${t}: ${e.message} Status: ${e.response?.status} Response: ${JSON.stringify(e.response?.data,null,2)}`):console.error(`Error creating content item ${t}: ${e}`),e}}async function g(e,t,a){try{let r=N[t];console.debug(`Adding language variant for language ${r?.id} to item ${e} with elements: ${JSON.stringify(a)}`);let n=await o.default.put(`${_.baseUrl}/${_.projectId}/items/${e}/variants/${r?.id}`,{elements:a},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Added language variant for language ${t} to item ${e}`),n.data}catch(a){throw o.default.isAxiosError(a)?console.error(`Error adding language variant for language ${t} to item ${e}: ${a.message} Status: ${a.response?.status} Response: ${JSON.stringify(a.response?.data,null,2)}`):console.error(`Error adding language variant for language ${t} to item ${e}: ${a}`),a}}async function $(){try{let{data:e}=await o.default.get(`${_.baseUrl}/${_.projectId}/workflows`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}}),t=e.filter(e=>"default"===e.codename)[0].steps.filter(e=>"review"===e.codename);return t[0]?.id}catch(e){throw console.error(`Error fetching review step id: ${e}`),e}}async function m(e,t,a){try{let r=await o.default.put(`${_.baseUrl}/${_.projectId}/items/${e}/variants/codename/${t}/change-workflow`,{workflow_identifier:{codename:"default"},step_identifier:{id:a}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Transitioned language variant for language ${t} of item ${e} to review step`),r.data}catch(a){throw console.error(`Error transitioning language variant for language ${t} of item ${e} to review step: ${a}`),a}}async function h(e,t){try{let a=await o.default.put(`${_.baseUrl}/${_.projectId}/items/${e}/variants/codename/${t}/publish`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${_.apiKey}`}});return console.info(`Published language variant for language ${t} of item ${e}`),a.data}catch(a){throw o.default.isAxiosError(a)?console.error(`Error publishing language variant for language ${t} of item ${e}: ${a.message} Status: ${a.response?.status} Response: ${JSON.stringify(a.response?.data,null,2)}`):console.error(`Error publishing language variant for language ${t} of item ${e}: ${a}`),a}}function v(e,t){return[{element:{codename:"title"},value:e[t]||e.default||""}]}function y(e){return Object.values(e).some(e=>{let t=e?.value;return Array.isArray(t)?t.length>0:"string"==typeof t&&t.trim().length>0})}async function E(e,t,a){console.info(`Processing CSV file: ${e}`);let o=[],i=Object.keys(N);_.projectId="prod"===t?b:w,_.contentTypeCodename=a;let s=0,d=[];return new Promise((E,w)=>{r.default.createReadStream(e).pipe((0,n.default)({headers:i})).on("data",e=>o.push(e)).on("end",async()=>{try{for(let e=1;e<o.length;e++){let r=o[e];for(let[e,n]of(console.debug(`Available languages in row: ${Object.keys(r).join(", ")}`),Object.entries(r))){if(!n?.trim())continue;let o=e.trim();if("codename"!==o)if(console.debug(`Checking language ${o} with value: ${n.trim()}`),n&&""!==n.trim()){console.debug(`Processing content item for language ${o} with value: ${n.trim()}`);let e=n.trim(),w=`${a}_${e.trim().toLowerCase().replace(/[\/]/g,"_").replace(/\+/g,"_").replace(/[-\s&]+/g,"_").replace(/[^a-z0-9_]/g,"")}`,b=await p(w);if(null==b&&void 0==b){console.debug(`Content item with codename ${w} does not exist. Response: ${JSON.stringify(b)}`);let a=await f(e,w),n=null;for(let e of("prod"===t&&(n=await $(),console.debug(`Review step id: ${n}`)),i)){let o=N[e];if(!o?.id||"codename"===o.codename)continue;let i=v(r,o.codename);await g(a.id,o.id,i),"prod"===t&&await m(a.id,o.id,n),await h(a.id,o.id),s++}}else{console.debug(`Content item with codename ${w} already exists with id: ${b.id}. Response: ${JSON.stringify(b)}`);let e=v(r,o),a=await l(b?.codename,o);null==a||void 0==a?y(e)&&await g(b?.id,o,e):y(e)&&(await c(b?.id,o),await u(b?.id,o,e));let n=null;"prod"===t&&(n=await $(),console.debug(`Review step id: ${n}`)),"prod"===t&&await m(b?.id,o,n),await h(b?.id,o),s++;continue}console.info(`CSV processing completed. Processed: ${s}, Unprocessed: 0 Unprocessed Records: ${JSON.stringify(d)}`),E({processedCount:s,unprocessedCount:0,unprocessedRecords:d})}else console.debug(`No value found for language ${o}`)}}}catch(e){console.error(`Error processing CSV: ${e}`),w(e)}}).on("error",e=>{console.error(`Error reading CSV file: ${e}`),w(e)})})}e.s(["processCsvFile",()=>E]),a()}catch(e){a(e)}},!1),7299,e=>e.a(async(t,a)=>{try{var r=e.i(2806),n=e.i(8307),o=e.i(9170),i=t([r,o]);[r,o]=i.then?(await i)():i,n.default.config();let s=async(e,t)=>{if(console.log("Received request method:",e.method),"POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let a,{files:n,fields:i}=await (a=new r.IncomingForm,new Promise((t,r)=>{a.parse(e,(e,a,n)=>{if(console.log("ðŸ“¥ Inside form.parse()"),e)return console.error("âŒ Error during form parsing:",e),r(e);t({fields:a,files:n})})}));if(!n.file)return t.status(400).json({message:"No file uploaded"});let s=Array.isArray(n.file)?n.file[0]:n.file;if(!s.filepath)return t.status(400).json({message:"Invalid file upload"});let d=i.environment,l=i.type,c=s.filepath,u=await (0,o.processCsvFile)(c,d[0],l[0]);return t.status(200).json({message:"File processed successfully",processedCount:u.processedCount,unprocessedCount:u.unprocessedCount,unprocessedRecords:u.unprocessedRecords})}catch(a){console.error("âŒ Error processing upload:",a);let e=a instanceof Error?a.message:"Error processing file";return t.status(500).json({message:e})}};e.s(["config",0,{api:{bodyParser:!1,externalResolver:!0},runtime:"nodejs"},"default",0,s]),a()}catch(e){a(e)}},!1),647,e=>e.a(async(t,a)=>{try{var r=e.i(5556),n=e.i(3756),o=e.i(5513),i=e.i(4858),s=e.i(7299),d=e.i(2918),l=e.i(7763),c=e.i(5979),u=t([s]);[s]=u.then?(await u)():u;let f=(0,i.hoist)(s,"default"),g=(0,i.hoist)(s,"config"),$=new o.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/uploadpicklist",pathname:"/api/uploadpicklist",bundlePath:"",filename:""},userland:s,distDir:".next",relativeProjectDir:""});async function p(e,t,a){$.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/uploadpicklist";n=n.replace(/\/index$/,"")||"/";let o=await $.prepare(e,t,{srcPage:n});if(!o){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:i,params:s,prerenderManifest:u,routerServerContext:p}=o;try{let a=e.method||"GET",r=(0,d.getTracer)(),o=r.getActiveScopeSpan(),c=$.instrumentationOnRequestError.bind($),f=async o=>$.render(e,t,{query:{...i,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:$.isDev,page:"/api/uploadpicklist",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!o)return;o.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${a} ${i}`;o.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),o.updateName(e)}else o.updateName(`${a} ${n}`)});o?await f(o):await r.withPropagatedContext(e.headers,()=>r.trace(l.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:d.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},f))}catch(e){if($.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,g,"default",0,f,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__d709abad._.js.map