module.exports=[95,e=>e.a(async(t,r)=>{try{let t=await e.y("axios-71350672325c4217");e.n(t),r()}catch(e){r(e)}},!0),406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},2734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},8307,(e,t,r)=>{t.exports=e.x("dotenv-629bad04a3c55d9b",()=>require("dotenv-629bad04a3c55d9b"))},8388,e=>{"use strict";e.i(8307).default.config();let t={projectId:("prod"===process.env.ENV?process.env.KONTENT_PROD_PROJECT_ID:process.env.KONTENT_DEV_PROJECT_ID)||"",apiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_MANAGEMENT_API_KEY:process.env.KONTENT_DEV_MANAGEMENT_API_KEY)||"",deliveryApiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_API_KEY:process.env.KONTENT_DEV_DELIVERY_API_KEY)||"",baseUrl:("prod"===process.env.ENV?process.env.KONTENT_PROD_BASE_URL:process.env.KONTENT_DEV_BASE_URL)||"",_DELIVERY_BASE_URL:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_BASE_URL:process.env.KONTENT_DEV_DELIVERY_BASE_URL)||"https://deliver.kontent.ai",contentTypeCodename:process.env.CONTENT_TYPE_CODENAME||""};function r(){return e.r(2734).appendFileSync("debug.txt",`Using config: ${JSON.stringify(t)}
`),t}e.s(["default",()=>r])},6280,e=>{"use strict";let t=0;function r(e){t=Math.max(0,Math.min(100,e))}function s(){return t}function a(){t=0}e.s(["getExportProgress",()=>s,"resetExportProgress",()=>a,"setExportProgress",()=>r])},1255,e=>{"use strict";function t(e){if(!e.length)return"";let t=Object.keys(e[0]);return[t.join(","),...e.map(e=>t.map(t=>`"${e[t]||""}"`).join(","))].join("\n")}e.s(["convertToCsv",()=>t])},4079,e=>e.a(async(t,r)=>{try{var s=e.i(95),a=t([s]);async function n(e,t,r){return(await s.default.get(`${t}/${e}/languages`,{headers:{Authorization:`Bearer ${r}`}})).data.languages.map(e=>e.codename)}[s]=a.then?(await a)():a,e.s(["fetchLanguages",()=>n]),r()}catch(e){r(e)}},!1),1760,e=>e.a(async(t,r)=>{try{var s=e.i(95),a=t([s]);async function n(e){let t,{projectId:r,deliveryApiKey:a,deliveryBaseUrl:n,systemType:o,language:i}=e,l=[];do{let e={Authorization:`Bearer ${a}`};t&&(e["x-continuation"]=t);let c=(await s.default.get(`${n}/${r}/items`,{headers:e,params:{"system.type":o,language:i}})).data;Array.isArray(c.items)&&l.push(...c.items),t=c.continuationToken}while(t)return l}[s]=a.then?(await a)():a,e.s(["fetchItemsByLanguage",()=>n]),r()}catch(e){r(e)}},!1),7630,e=>e.a(async(t,r)=>{try{var s=e.i(8388),a=e.i(4079),n=e.i(1760),o=e.i(1255),i=e.i(6280),l=t([a,n]);async function c(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{environment:r,queryParams:l}=e.body;if(!r||!["dev","prod"].includes(r))return t.status(400).json({error:"Invalid environment"});let c=l?.["system.type"];if(!c||""===c.trim())return t.status(400).json({error:"system.type is required"});let{projectId:u,deliveryApiKey:p,_DELIVERY_BASE_URL:d,apiKey:E,baseUrl:f}=(0,s.default)();try{let e=await (0,a.fetchLanguages)(u,f,E);console.log("Fetched languages:",e);let s=await (0,n.fetchItemsByLanguage)({projectId:u,deliveryBaseUrl:d,deliveryApiKey:p,systemType:c,language:"default"});console.log(`Fetched ${s.length} base items for system.type ${c}`);let l={};s.forEach(e=>{e.system&&e.system.codename&&(l[e.system.codename]={})});let g=e.length*s.length,h=0;(0,i.resetExportProgress)(),(0,i.setExportProgress)(1);let v={};for(let t of e)for(let e of(await (0,n.fetchItemsByLanguage)({projectId:u,deliveryApiKey:p,deliveryBaseUrl:d,systemType:c,language:t}))){let r=e.system?.codename;if(!r)continue;v[r]||(v[r]={codename:r}),v[r][t]=e.elements?.title?.value??"",h++;let s=Math.round(h/g*100);(0,i.setExportProgress)(s)}(0,i.setExportProgress)(100);let y=Object.values(v);if(console.log("Total rows to export:",y.length),0===y.length)return t.status(404).json({error:"No data found"});let m="\uFEFF"+(0,o.convertToCsv)(y),_=Buffer.from(m,"utf-8"),x=c.replace(/[\\/:*?"<>|+ ]/g,"_").toLowerCase(),N=`TravelHotel_${r}_${x}.csv`;return t.setHeader("Content-Type","text/csv; charset=utf-8"),t.setHeader("Content-Disposition",`attachment; filename="${N}"`),t.status(200).send(_)}catch(e){return console.error("Export error:",e),t.status(500).json({error:"Failed to export CSV"})}}[a,n]=l.then?(await l)():l,e.s(["default",()=>c]),r()}catch(e){r(e)}},!1),940,e=>e.a(async(t,r)=>{try{var s=e.i(5556),a=e.i(3756),n=e.i(5513),o=e.i(4858),i=e.i(7630),l=e.i(2918),c=e.i(7763),u=e.i(5979),p=t([i]);[i]=p.then?(await p)():p;let E=(0,o.hoist)(i,"default"),f=(0,o.hoist)(i,"config"),g=new n.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/exportCSVList",pathname:"/api/exportCSVList",bundlePath:"",filename:""},userland:i,distDir:".next",relativeProjectDir:""});async function d(e,t,r){g.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/exportCSVList";a=a.replace(/\/index$/,"")||"/";let n=await g.prepare(e,t,{srcPage:a});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:o,params:i,prerenderManifest:p,routerServerContext:d}=n;try{let r=e.method||"GET",s=(0,l.getTracer)(),n=s.getActiveScopeSpan(),u=g.instrumentationOnRequestError.bind(g),E=async n=>g.render(e,t,{query:{...o,...i},params:i,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:g.isDev,page:"/api/exportCSVList",internalRevalidate:null==d?void 0:d.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=s.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${r} ${o}`;n.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),n.updateName(e)}else n.updateName(`${r} ${a}`)});n?await E(n):await s.withPropagatedContext(e.headers,()=>s.trace(c.BaseServerSpan.handleRequest,{spanName:`${r} ${a}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},E))}catch(e){if(g.isDev)throw e;(0,s.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,f,"default",0,E,"handler",()=>d]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__35dcff76._.js.map