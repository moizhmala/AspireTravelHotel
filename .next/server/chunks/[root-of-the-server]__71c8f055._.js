module.exports=[3324,(e,t,a)=>{t.exports=e.x("inspector",()=>require("inspector"))},737,e=>e.a(async(t,a)=>{try{var r=e.i(2734);e.i(9934);var n=e.i(95),i=e.i(8307),o=e.i(8388),d=e.i(9740),s=e.i(3324),l=t([n]);[n]=l.then?(await l)():l,i.default.config();let S=process.env.KONTENT_DEV_PROJECT_ID||"",x=process.env.KONTENT_PROD_PROJECT_ID||"",E=(0,o.default)(),F={default:{codename:"default",id:"00000000-0000-0000-0000-000000000000"},"de-DE":{codename:"de-DE",id:"79228548-6576-5a60-acad-53360bf23687"},"ja-JP":{codename:"ja-JP",id:"4e8fa49a-27d3-44a7-8135-3dc21008ddd1"},"ko-KR":{codename:"ko-KR",id:"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812"},"zh-HK":{codename:"zh-HK",id:"e832b221-cbe7-442a-8edf-98a7ac7afac6"},"zh-TW":{codename:"zh-TW",id:"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed"},"ar-AE":{codename:"ar-AE",id:"3dc9c67d-95d8-4594-890d-70f98c615fbd"},"es-MX":{codename:"es-MX",id:"0814121f-7011-4361-b7bd-cebd74fe4cd9"}};async function c(t){try{e.r(2734).appendFileSync("debug.txt",`Fetching element ID map for type: ${E.baseUrl}/${E.projectId}/types/codename/${t}
`);let a=await n.default.get(`${E.baseUrl}/${E.projectId}/types/codename/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}}),r={};for(let e of a.data.elements)r[e.name.trim()]=e.id;return r}catch(e){throw s.console.error(`‚ùå Error fetching element ID map for type "${t}":`,e),e}}async function p(e){try{return(await n.default.get(`${E.baseUrl}/${E.projectId}/items/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}})).data}catch(e){return s.console.error(`Error finding content item: ${e}`),!1}}async function u(t,a){try{return e.r(2734).appendFileSync("debug.txt",`Finding content item variant: ${E.baseUrl}/${E.projectId}/items/${t}/variants/${a}
`),(await n.default.get(`${E.baseUrl}/${E.projectId}/items/${t}/variants/codename/${a}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}})).data}catch(e){return s.console.error(`Error finding content item variant: ${e}`),!1}}async function g(t,a,r){try{let r=await u(t,a);if(e.r(2734).appendFileSync("debug.txt",`Current workflow step for ${a}: ${r.workflow_step?.id||"N/A"}
`),r.workflow_step?.id==="eee6db3b-545a-4785-8e86-e3772c8756f9"){e.r(2734).appendFileSync("debug.txt",`Deleting existing draft version for: ${E.baseUrl}/${E.projectId}/items/${t}/variants/codename/${a}
`);let r=await n.default.delete(`${E.baseUrl}/${E.projectId}/items/${t}/variants/codename/${a}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}});return e.r(2734).appendFileSync("debug.txt",`‚úÖ Deleted existing draft version for language: ${a}
`),r.data}}catch(e){throw s.console.error(`Error deleting existing draft version: ${e}`),e}}async function f(t,a,r){try{let i=await n.default.post(`${E.baseUrl}/${E.projectId}/items`,{name:t,codename:a,type:{codename:r}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}});return e.r(2734).appendFileSync("debug.txt",`‚úÖ Created content item: ${a}
`),i.data}catch(t){throw e.r(2734).appendFileSync("debug.txt",`Error creating content item: ${t}
`),t}}async function m(t,a){try{let e=await n.default.put(`${E.baseUrl}/${E.projectId}/items/${t}/variants/codename/${a}/new-version`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}});return r.default.appendFileSync("debug.txt",`‚úÖ Variant new version created for language ${a}
`),e.data}catch(t){throw e.r(2734).appendFileSync("debug.txt",`Error creating language variant: ${t}
`),t}}async function y(t,a,r,i,o,d,s){try{e.r(2734).appendFileSync("debug.txt",`Adding language variant ${E.baseUrl}/${E.projectId}/items/${t}/variants/${a}
`);let l={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${E.apiKey}`},c={elements:[...s,{element:{codename:"content_type"},value:[{codename:r}]},{element:{codename:"name"},value:i},{element:{codename:"client_availability"},value:[{codename:"client_availability_list_restricted"}]},{element:{codename:"client_id"},value:[{codename:o}]},{element:{codename:"program_id"},value:[{codename:d}]}]};e.r(2734).appendFileSync("debug.txt",`requestBody to add: ${JSON.stringify(c,null,2)}
`);let p=await n.default.put(`${E.baseUrl}/${E.projectId}/items/${t}/variants/${a}`,c,{headers:l});return e.r(2734).appendFileSync("debug.txt",`‚úÖ Variant update success for language ${a}
`),p.data}catch(t){throw n.default.isAxiosError(t)?e.r(2734).appendFileSync("debug.txt",`Error Adding language variant | Axios error: ${t}
`):e.r(2734).appendFileSync("debug.txt",`Error Adding language variant | Non-axios error: ${t}
`),t}}async function $(){try{let{data:e}=await n.default.get(`${E.baseUrl}/${E.projectId}/workflows`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}}),t=e.filter(e=>"default"===e.codename)[0].steps.filter(e=>"review"===e.codename);return t[0]?.id}catch(e){throw s.console.error(`Error publishing language variant: ${e}`),e}}async function h(e,t,a){try{return(await n.default.put(`${E.baseUrl}/${E.projectId}/items/${e}/variants/codename/${t}/change-workflow`,{workflow_identifier:{codename:"default"},step_identifier:{id:a}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.apiKey}`}})).data}catch(e){throw s.console.error(`Error publishing language variant: ${e}`),e}}async function b(t,a){try{new Date(Date.now()+18e5).toISOString();let r=await n.default.put(`${E.baseUrl}/${E.projectId}/items/${t}/variants/codename/${a}/publish`,{},{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${E.apiKey}`}});return e.r(2734).appendFileSync("debug.txt",`‚úÖ Published language variant ${a}
`),r.data}catch(t){throw e.r(2734).appendFileSync("debug.txt",`Error publishing language variant: ${t}
`),t}}async function w(e,t){try{let a=await n.default.get(`${E.baseUrl}/${E.projectId}/items/${e}/variants/codename/${t}`,{headers:{Authorization:`Bearer ${E.apiKey}`,"Content-Type":"application/json"}});return 200===a.status}catch(e){if(e.response?.status===404)return!1;throw e}}async function v(t,a,r){let n;s.console.log(`Processing XLSX file: ${t}`);let i=d.readFile(t),o=i.Sheets[i.SheetNames[0]],l=d.utils.sheet_to_json(o,{header:1}),u=[],v="";for(let e=3;e<l[1].length;e++){let t=l[0][e],a=l[1][e];t?.trim()&&(v=t.trim()),s.console.debug(`Processing column ${e}: Language: ${v}, Variable: ${a}`);let r=a?.trim();v&&r&&u.push({language:v,variable:r,columnIndex:e})}let _="travel_header_footer_model";E.projectId="prod"===a?x:S,E.apiKey="prod"===a?process.env.KONTENT_PROD_MANAGEMENT_API_KEY?.toString()??"":process.env.KONTENT_DEV_MANAGEMENT_API_KEY?.toString()??"",E.contentTypeCodename=r;try{n=await c(_)}catch(t){throw e.r(2734).appendFileSync("debug.txt","‚ùå Failed to fetch element ID map:"+t+"\n"),t}let j={};for(let[t,a]of Object.entries(n))if("string"==typeof a){let r=t.replace(/\s+/g," ").trim();e.r(2734).appendFileSync("debug.txt",`üîë Normalizing key: "${t}" to "${r}" with value: ${a}
`),j[r]=a}else e.r(2734).appendFileSync("debug.txt",`‚ö†Ô∏è Unexpected non-string value for key: ${t}`+a+"\n");let A=0,C=0,T=[];for(let t=2;t<l.length;t++){let n=l[t];if(!n[2])continue;let i=String(n[2]).trim(),o=i.replace(/\s+/g,"_").toLowerCase(),d="email_template"===r?"email":"web",c=i+" "+d.charAt(0).toUpperCase()+d.slice(1),v=`${o}_${d}`;try{let t=await p(v);e.r(2734).appendFileSync("debug.txt",`üîç Searching for content item: ${v}
`),t?e.r(2734).appendFileSync("debug.txt",`üîÑ Content item exists. Updating: ${v}
`):(e.r(2734).appendFileSync("debug.txt",`üîß Content item does not exist. Creating: ${v}
`),t=await f(c,v,_));let r="prod"===a?await $():null,o={},l={},S={},x={},E={};for(let{language:t,variable:a,columnIndex:r}of u){let i=n[r];e.r(2734).appendFileSync("debug.txt",`üìÑ Check point 1 Processing item: ${c} (${v}) | ${t.trim()} | Columnn: ${r} | Variable: ${a} 
`);let d=F[t.trim()];if(e.r(2734).appendFileSync("debug.txt",`üîé Processing language: "${d.codename}" | "${d.id}" and value: XXX
`),!d){e.r(2734).appendFileSync("debug.txt",`‚ö†Ô∏è Language not found: "${t}"
`);continue}let p=d.id,u=d.codename;l[p]=u,S[p]=n[2]+" Web",x[p]="client_id_list_"+n[1].toString().toLowerCase(),E[p]="program_id_list_"+n[2].toString().replace(/\s+/g,"_").toLowerCase();let g=a.replace(/^(Web|Email)\s+/i,"").replace(/\b(HTML|Style|Script)\b/,e=>{switch(e){case"HTML":return"HTML";case"Style":return"CSS";case"Script":return"Script";default:return e}}).replace(/\s+/g," ").trim(),f=j[g];if(!f){e.r(2734).appendFileSync("debug.txt",`‚ö†Ô∏è Element ID not found for variable: "${g}"
`);continue}if(!p){e.r(2734).appendFileSync("debug.txt",`‚ö†Ô∏è Language code not found for: "${t}"
`);continue}let m=String(i||"").trim();try{e.r(2734).appendFileSync("debug.txt",`üîé Processing value for variable "${g}": 
`),("Header HTML"===g||"Footer HTML"===g||"Header CSS"===g||"Footer CSS"===g)&&(m=String(i||"").replace(/<!--[\s\S]*?-->/g,"").replace(/\s{2,}/g," ").replace(/\n/g,"").replace(/\r/g,"").replace(/>\s+</g,"><").replace(/\\"/g,'"').replace(/\"/,'"').trim())}catch(e){s.console.error("‚ùå Failed to write to debug.txt:",e)}o[d.id]||(o[d.id]=[]),"string"==typeof m&&m.trim().length>0&&o[p].push({element:{id:f},value:m})}for(let[n,i]of(A++,Object.entries(o))){if(0===i.length){e.r(2734).appendFileSync("debug.txt",`‚ö†Ô∏è No elements to process for language ID: ${n}. Skipping.
`);continue}let o=l[n];e.r(2734).appendFileSync("debug.txt",`üì§ Updating/Creating variant for language: ${o} with elements: 
`);let s=await w(t.id,o);e.r(2734).appendFileSync("debug.txt",`Variant details for language ${o}: ${JSON.stringify(s,null,2)}
`),s?(e.r(2734).appendFileSync("debug.txt",`üîÑ Variant exists for language: ${o}. Updating existing variant.
`),await g(t.id,o,s),await m(t.id,o)):e.r(2734).appendFileSync("debug.txt",`üîß Variant does not exist for language: ${o}. Creating new variant.
`),await y(t.id,n,d,S[n],x[n],E[n],i),"prod"===a&&r&&await h(t.id,o,r),await b(t.id,o)}e.r(2734).appendFileSync("debug.txt",`‚úÖ Successfully processed item: ${i}
`)}catch(r){let t=r?.response?.data,a=t?.validation_errors?.[0]?.message||r.message;e.r(2734).appendFileSync("debug.txt",`‚ùå Error processing item: ${i}: ${a}
`),T.push({name:i,reason:a}),C++}}return{processedCount:A,unprocessedCount:C,unprocessedRecords:T}}e.s(["processXlsxFile",()=>v]),a()}catch(e){a(e)}},!1),1440,e=>e.a(async(t,a)=>{try{var r=e.i(2806),n=e.i(8307),i=e.i(737),o=t([r,i]);[r,i]=o.then?(await o)():o,n.default.config();let d=async(e,t)=>{if(console.log("Received request method:",e.method),"POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let a,{files:n,fields:o}=await (a=new r.IncomingForm,new Promise((t,r)=>{a.parse(e,(e,a,n)=>{if(console.log("üì• Inside form.parse()"),e)return console.error("‚ùå Error during form parsing:",e),r(e);t({fields:a,files:n})})}));if(!n.file)return t.status(400).json({message:"No file uploaded"});let d=Array.isArray(n.file)?n.file[0]:n.file;if(!d.filepath)return t.status(400).json({message:"Invalid file upload"});let s=o.environment,l=o.type,c=d.filepath,p=await (0,i.processXlsxFile)(c,s[0],l[0]);return t.status(200).json({message:"File processed successfully",processedCount:p.processedCount,unprocessedCount:p.unprocessedCount,unprocessedRecords:p.unprocessedRecords})}catch(a){console.error("‚ùå Error processing upload:",a);let e=a instanceof Error?a.message:"Error processing file";return t.status(500).json({message:e})}};e.s(["config",0,{api:{bodyParser:!1,externalResolver:!0},runtime:"nodejs"},"default",0,d]),a()}catch(e){a(e)}},!1),1675,e=>e.a(async(t,a)=>{try{var r=e.i(5556),n=e.i(3756),i=e.i(5513),o=e.i(4858),d=e.i(1440),s=e.i(2918),l=e.i(7763),c=e.i(5979),p=t([d]);[d]=p.then?(await p)():p;let g=(0,o.hoist)(d,"default"),f=(0,o.hoist)(d,"config"),m=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/uploadheaderfooter",pathname:"/api/uploadheaderfooter",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function u(e,t,a){m.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/uploadheaderfooter";n=n.replace(/\/index$/,"")||"/";let i=await m.prepare(e,t,{srcPage:n});if(!i){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:o,params:d,prerenderManifest:p,routerServerContext:u}=i;try{let a=e.method||"GET",r=(0,s.getTracer)(),i=r.getActiveScopeSpan(),c=m.instrumentationOnRequestError.bind(m),g=async i=>m.render(e,t,{query:{...o,...d},params:d,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:p.preview,propagateError:!1,dev:m.isDev,page:"/api/uploadheaderfooter",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${a} ${o}`;i.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),i.updateName(e)}else i.updateName(`${a} ${n}`)});i?await g(i):await r.withPropagatedContext(e.headers,()=>r.trace(l.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},g))}catch(e){if(m.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,f,"default",0,g,"handler",()=>u]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__71c8f055._.js.map