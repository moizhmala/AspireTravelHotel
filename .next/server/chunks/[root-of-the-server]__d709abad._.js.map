{"version":3,"sources":["../../../../TravelHotel/src/utils/config.ts","../../../../TravelHotel/src/utils/picklistgenerator.ts","../../../../TravelHotel/src/pages/api/uploadpicklist.ts","../../../../TravelHotel/node_modules/next/src/build/templates/pages-api.ts"],"sourcesContent":["import dotenv from \"dotenv\";\n\ndotenv.config();\n\ninterface Config {\n  projectId: string;\n  apiKey: string;\n  deliveryApiKey: string;\n  baseUrl: string;\n  _DELIVERY_BASE_URL: string;\n  contentTypeCodename: string;\n}\n\nconst config: Config = {\n  projectId:\n    (process.env.ENV === \"prod\"\n      ? process.env.KONTENT_PROD_PROJECT_ID\n      : process.env.KONTENT_DEV_PROJECT_ID) || \"\",\n  apiKey:\n    (process.env.ENV === \"prod\"\n      ? process.env.KONTENT_PROD_MANAGEMENT_API_KEY \n      : process.env.KONTENT_DEV_MANAGEMENT_API_KEY) || \"\",\n  deliveryApiKey:\n    (process.env.ENV === \"prod\"\n      ? process.env.KONTENT_PROD_DELIVERY_API_KEY\n      : process.env.KONTENT_DEV_DELIVERY_API_KEY) || \"\",\n  baseUrl:\n    (process.env.ENV === \"prod\"\n      ? process.env.KONTENT_PROD_BASE_URL\n      : process.env.KONTENT_DEV_BASE_URL) || \"\",\n  _DELIVERY_BASE_URL:\n    (process.env.ENV === \"prod\"\n      ? process.env.KONTENT_PROD_DELIVERY_BASE_URL\n      : process.env.KONTENT_DEV_DELIVERY_BASE_URL) || \"https://deliver.kontent.ai\",\n  contentTypeCodename: process.env.CONTENT_TYPE_CODENAME || \"\",\n};\n\nexport default function getKontentConfig() {\n  require(\"fs\").appendFileSync(\"debug.txt\", `Using config: ${JSON.stringify(config)}` + \"\\n\");\n  return config;\n}\n","import fs from \"fs\";\r\nimport csv from \"csv-parser\";\r\nimport axios, { AxiosError } from \"axios\";\r\nimport dotenv from \"dotenv\";\r\nimport getKontentConfig from \"./config\";\r\nimport * as xlsx from \"xlsx\";\r\n\r\ndotenv.config();\r\n\r\ninterface Config {\r\n  projectId: string;\r\n  apiKey: string;\r\n  deliveryApiKey: string;\r\n  baseUrl: string;\r\n  contentTypeCodename: string;\r\n  _DELIVERY_BASE_URL: string;\r\n}\r\n\r\ninterface ValidationError {\r\n  message: string;\r\n}\r\n\r\ninterface ApiErrorResponse {\r\n  validation_errors: ValidationError[];\r\n}\r\n\r\nconst DEV_PROJECT_ID = process.env.KONTENT_DEV_PROJECT_ID || \"\";\r\nconst PROD_PROJECT_ID = process.env.KONTENT_PROD_PROJECT_ID || \"\";\r\n\r\nconst config: Config = getKontentConfig();\r\n\r\ntype LanguageMap = {\r\n  [key: string]: {\r\n    codename: string;\r\n    id: string;\r\n  };\r\n};\r\n\r\nconst languageMap: LanguageMap = {\r\n  \"default\": { codename: \"default\", id: \"00000000-0000-0000-0000-000000000000\" },\r\n  \"de-DE\": { codename: \"de-DE\", id: \"79228548-6576-5a60-acad-53360bf23687\" },\r\n  \"ja-JP\": { codename: \"ja-JP\", id: \"4e8fa49a-27d3-44a7-8135-3dc21008ddd1\" },\r\n  \"ko-KR\": { codename: \"ko-KR\", id: \"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812\" },\r\n  \"zh-HK\": { codename: \"zh-HK\", id: \"e832b221-cbe7-442a-8edf-98a7ac7afac6\" },\r\n  \"zh-TW\": { codename: \"zh-TW\", id: \"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed\" },\r\n  \"ar-AE\": { codename: \"ar-AE\", id: \"3dc9c67d-95d8-4594-890d-70f98c615fbd\" },\r\n  \"es-MX\": { codename: \"es-MX\", id: \"0814121f-7011-4361-b7bd-cebd74fe4cd9\" }\r\n};\r\n\r\ninterface KontentItemResponse {\r\n  id: string;\r\n  codename: string;\r\n  name: string;\r\n  //system: Record<string, any>;\r\n  //elements: Record<string, any>;\r\n}\r\n\r\nasync function findLanguageVariant(\r\n  contentItemCodename: string,\r\n  languageId: string\r\n): Promise<KontentItemResponse | null> {\r\n  try {\r\n    console.info(`${config.baseUrl}/${config.projectId}/items/codename/${contentItemCodename}/variants/codename/${languageId}`)\r\n    const response = await axios.get(\r\n      `${config.baseUrl}/${config.projectId}/items/codename/${contentItemCodename}/variants/codename/${languageId}`,\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.debug(`Found language variant for language ${languageId} of content item ${contentItemCodename}. Response: ${JSON.stringify(response.data)}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    // If the error is a 404, it means the language variant does not exist, which is an expected scenario. We can return null in this case. For any other error, we should log it and rethrow.\r\n    const err = error as AxiosError;\r\n    if (err.response?.status === 404) {\r\n      console.debug(`Language variant for language ${languageId} of content item ${contentItemCodename} not found. This is expected if the variant does not exist.`);\r\n      return null;\r\n    }\r\n    else {\r\n      console.error(`Error finding language variant for language ${languageId} of content item ${contentItemCodename}: ${error}`);\r\n    }\r\n    throw error; // real error\r\n  }\r\n}\r\n\r\nasync function newversionLanguageVariant(\r\n  itemId: string,\r\n  languageId: string\r\n) {\r\n  try {\r\n    console.debug(`Creating new version of language variant for language ${languageId} of item ${itemId}`);\r\n    const response = await axios.put(\r\n      `${config.baseUrl}/${config.projectId}/items/${itemId}/variants/codename/${languageId}/new-version`,\r\n      {}, \r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Created new version of language variant for language ${languageId} of item ${itemId}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Error creating new version of language variant for language ${languageId} of item ${itemId}: ${error}`);\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function updateLanguageVariant(\r\n  itemId: string,\r\n  languageId: string,\r\n  elements: {\r\n    element: { codename: string };\r\n    value: string;\r\n  }[]\r\n) {\r\n  try {\r\n    const languageInfo = getLanguageInfo(languageId);\r\n    console.debug(`Updating language variant. ${config.baseUrl}/${config.projectId}/items/${itemId}/variants/${languageInfo?.id}`);\r\n\r\n    const requestBody = {\r\n      \"elements\": \r\n         elements\r\n    };\r\n    console.info(`Updating language variant for language ${languageId} of item ${itemId} with elements: ${JSON.stringify(requestBody)}`);\r\n    \r\n    const response = await axios.put(\r\n      `${config.baseUrl}/${config.projectId}/items/${itemId}/variants/${languageInfo?.id}`,\r\n      requestBody,\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Updated language variant for language ${languageId} of item ${itemId}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Error updating language variant for language ${languageId} of item ${itemId}: ${error}`);\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function findContentItem(contentItemCodename: string): Promise<KontentItemResponse | null> {\r\n  try {\r\n\r\n    const response = await axios.get(\r\n      `${config.baseUrl}/${config.projectId}/items/codename/${contentItemCodename}`,\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Found content item with codename ${contentItemCodename} and id: ${response.data.id}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Error finding content item with codename ${contentItemCodename}: ${error}`);\r\n    throw error; // real error\r\n  }\r\n}\r\n\r\nasync function createContentItem(itemName: string, itemCodename: string) {\r\n  try {\r\n    const response = await axios.post(\r\n      `${config.baseUrl}/${config.projectId}/items`,\r\n      {\r\n        name: itemName,\r\n        codename: itemCodename,\r\n        type: { codename: config.contentTypeCodename },\r\n      },\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Created content item ${itemCodename} with id: ${response.data.id}`);\r\n    return response.data;\r\n  } catch (error) {\r\n      if (axios.isAxiosError(error)) {  \r\n        console.error(`Error creating content item ${itemCodename}: ${error.message} Status: ${error.response?.status} Response: ${JSON.stringify(error.response?.data, null, 2)}`); \r\n      } else {\r\n        console.error(`Error creating content item ${itemCodename}: ${error}`); \r\n      }\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function addLanguageVariant(\r\n  itemId: string,\r\n  languageId: string,\r\n  elements: {\r\n    element: { codename: string };\r\n    value: string;\r\n  }[]\r\n) {\r\n  try {\r\n    const languageInfo = getLanguageInfo(languageId);\r\n    console.debug(`Adding language variant for language ${languageInfo?.id} to item ${itemId} with elements: ${JSON.stringify(elements)}`);\r\n    \r\n    const response = await axios.put(\r\n      `${config.baseUrl}/${config.projectId}/items/${itemId}/variants/${languageInfo?.id}`,\r\n      {\r\n        elements,\r\n      },\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Added language variant for language ${languageId} to item ${itemId}`);\r\n    return response.data;\r\n  } catch (error) {\r\n      if (axios.isAxiosError(error)) {  \r\n        console.error(`Error adding language variant for language ${languageId} to item ${itemId}: ${error.message} Status: ${error.response?.status} Response: ${JSON.stringify(error.response?.data, null, 2)}`);  \r\n      } else {\r\n        console.error(`Error adding language variant for language ${languageId} to item ${itemId}: ${error}`); \r\n      } \r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function fetchReviewStepId() {\r\n  try {\r\n    // https://manage.kontent.ai/v2/projects/0fbc3572-8f63-0030-94d3-231315ab5e58/workflows\r\n    const response = await axios.get(\r\n      `${config.baseUrl}/${config.projectId}/workflows`,\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    const { data } = response;\r\n\r\n    const defaultWorkflow = data.filter(\r\n      (d: { codename: string }) => d.codename === \"default\"\r\n    );\r\n\r\n    const reviewStep = defaultWorkflow[0].steps.filter(\r\n      (d: { codename: string }) => d.codename === \"review\"\r\n    );\r\n\r\n    return reviewStep[0]?.id;\r\n  } catch (error) {\r\n    console.error(`Error fetching review step id: ${error}`);\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function transitionLanguageToReview(\r\n  itemId: string,\r\n  languageId: string,\r\n  reviewStepId: string\r\n) {\r\n  // https://manage.kontent.ai/v2/projects/0fbc3572-8f63-0030-94d3-231315ab5e58/items/23de5f44-473b-5817-8128-4e12c2e495ad/variants/codename/default/change-workflow\r\n  try {\r\n    const response = await axios.put(\r\n      `${config.baseUrl}/${config.projectId}/items/${itemId}/variants/codename/${languageId}/change-workflow`,\r\n      {\r\n        workflow_identifier: {\r\n          codename: \"default\",\r\n        },\r\n        step_identifier: {\r\n          id: reviewStepId,\r\n        },\r\n      },\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Transitioned language variant for language ${languageId} of item ${itemId} to review step`);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Error transitioning language variant for language ${languageId} of item ${itemId} to review step: ${error}`);\r\n    throw error;\r\n  }\r\n}\r\n\r\nasync function publishLanguageVariant(itemId: string, languageId: string) {\r\n  try {\r\n    const response = await axios.put(\r\n      `${config.baseUrl}/${config.projectId}/items/${itemId}/variants/codename/${languageId}/publish`,\r\n      {},\r\n      {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${config.apiKey}`,\r\n        },\r\n      }\r\n    );\r\n    console.info(`Published language variant for language ${languageId} of item ${itemId}`);\r\n    return response.data;\r\n  } catch (error) {\r\n      if (axios.isAxiosError(error)) {  \r\n        console.error(`Error publishing language variant for language ${languageId} of item ${itemId}: ${error.message} Status: ${error.response?.status} Response: ${JSON.stringify(error.response?.data, null, 2)}`);  \r\n      }\r\n      else {  \r\n        console.error(`Error publishing language variant for language ${languageId} of item ${itemId}: ${error}`);  \r\n      }\r\n    throw error;\r\n  }\r\n}\r\n\r\ntype CsvRow = Record<string, string>;\r\n\r\nfunction mapCsvRowToElements(row: CsvRow, languageColumn: string) {\r\n  return [\r\n    {\r\n      element: { codename: \"title\" },\r\n      value: row[languageColumn] || row[\"default\"] || \"\",\r\n    },\r\n  ];\r\n}\r\n\r\n// function getLanguageId(languageCode: string): string | undefined {\r\n//   return languageMap[languageCode];\r\n// }\r\n\r\nfunction getLanguageInfo(languageCode: string): { codename: string; id: string } | undefined {\r\n\r\n  return languageMap[languageCode];\r\n}\r\n\r\nfunction toCodename(input: string): string {\r\n  return input\r\n    .trim()\r\n    .toLowerCase()\r\n    .replace(/[\\/]/g, \"_\")        // replace /\r\n    .replace(/\\+/g, \"_\")        // replace +\r\n    .replace(/[-\\s&]+/g, \"_\")     // replace space, -, &\r\n    .replace(/[^a-z0-9_]/g, \"\");   // remove anything else unsafe\r\n    //.replace(/_+/g, \"_\")          // collapse multiple _\r\n    //.replace(/^_+|_+$/g, \"\");     // trim leading/trailing _\r\n}\r\n\r\nfunction hasAnyElementValue(elements: Record<string, any>): boolean {\r\n  return Object.values(elements).some((element) => {\r\n    const value = element?.value;\r\n\r\n    if (Array.isArray(value)) {\r\n      return value.length > 0;\r\n    }\r\n\r\n    if (typeof value === \"string\") {\r\n      return value.trim().length > 0;\r\n    }\r\n\r\n    return false;\r\n  });\r\n}\r\n\r\nexport async function processCsvFile(\r\n  filePath: string,\r\n  userEnvVariable: string,\r\n  type: string\r\n) {\r\n  \r\n  console.info(`Processing CSV file: ${filePath}`);\r\n\r\n  const results: CsvRow[] = [];\r\n  const languages = Object.keys(languageMap);\r\n\r\n  config.projectId =\r\n    userEnvVariable === \"prod\" ? PROD_PROJECT_ID : DEV_PROJECT_ID;\r\n\r\n  config.contentTypeCodename = type;\r\n\r\n  let processedCount = 0;\r\n  let unprocessedCount = 0;\r\n  const unprocessedRecords: { name: string; reason: string }[] = [];\r\n\r\n  return new Promise((resolve, reject) => {\r\n    fs.createReadStream(filePath)\r\n      .pipe(csv({ headers: languages }))\r\n      .on(\"data\", (row: CsvRow) => results.push(row))\r\n      .on(\"end\", async () => {\r\n        try {\r\n          for (let i = 1; i < results.length; i++) {\r\n            const row = results[i];\r\n            console.debug(`Available languages in row: ${Object.keys(row).join(\", \")}`);\r\n            \r\n            //Check for each language and value\r\n            for (const [languageCode, value] of Object.entries(row)) {\r\n              if (!value?.trim()) continue;\r\n              const key = languageCode.trim();\r\n\r\n              if (key === \"codename\") continue; // skip codename column for language variant processing\r\n\r\n              console.debug(`Checking language ${key} with value: ${value.trim()}`);\r\n              \r\n              //const value = row[keyToFind as keyof typeof row];\r\n\r\n              if (value && value.trim() !== \"\") {\r\n                console.debug(`Processing content item for language ${key} with value: ${value.trim()}`);\r\n\r\n                const itemName = value.trim();\r\n                const itemCodename = `${type}_${toCodename(itemName)}`;\r\n                  \r\n                  let contentItem = await findContentItem(itemCodename);\r\n\r\n                  //If content item does not exists, add the content item\r\n                  if (contentItem == null && contentItem == undefined) {\r\n                    console.debug(`Content item with codename ${itemCodename} does not exist. Response: ${JSON.stringify(contentItem)}`);\r\n\r\n                    const contentItemNew = await createContentItem(\r\n                      itemName,\r\n                      itemCodename\r\n                    );\r\n\r\n                    let reviewStepId = null;\r\n                    if (userEnvVariable === \"prod\") {\r\n                      reviewStepId = await fetchReviewStepId();\r\n                      console.debug(`Review step id: ${reviewStepId}`);\r\n                    }\r\n                    for (const language of languages) {\r\n                      const languageInfo = getLanguageInfo(language);\r\n\r\n                      //const languageId = getLanguageId(language);\r\n                      if (!languageInfo?.id) continue;\r\n                      if (languageInfo.codename === \"codename\") continue; // skip default language for variant creation\r\n\r\n                      const elements = mapCsvRowToElements(row, languageInfo.codename);\r\n                      await addLanguageVariant(contentItemNew.id, languageInfo.id, elements);\r\n                      if (userEnvVariable === \"prod\") {\r\n                        await transitionLanguageToReview(\r\n                          contentItemNew.id,\r\n                          languageInfo.id,\r\n                          reviewStepId\r\n                        );\r\n                      }\r\n                      await publishLanguageVariant(contentItemNew.id, languageInfo.id);\r\n\r\n                      processedCount++;\r\n                    } //end for languages\r\n                  } //end if content item exists\r\n                  else {\r\n                    //contentItem = await findContentItem(itemCodename);\r\n                    \r\n                    console.debug(`Content item with codename ${itemCodename} already exists with id: ${contentItem.id}. Response: ${JSON.stringify(contentItem)}`);\r\n                    const elements = mapCsvRowToElements(row, key);\r\n\r\n                    let contentItemVariant = await findLanguageVariant(\r\n                      contentItem?.codename,\r\n                      key\r\n                    );\r\n\r\n                    if (contentItemVariant==null || contentItemVariant==undefined) {\r\n                      if (hasAnyElementValue(elements)) {\r\n                        await addLanguageVariant(contentItem?.id, key, elements);  \r\n                      }\r\n                    }\r\n                    else {\r\n                      if (hasAnyElementValue(elements)) {\r\n                        await newversionLanguageVariant(\r\n                          contentItem?.id,\r\n                          key\r\n                        );\r\n                        await updateLanguageVariant(contentItem?.id, key, elements);\r\n                      }\r\n                    }\r\n\r\n                    let reviewStepId = null;\r\n                    if (userEnvVariable === \"prod\") {\r\n                    reviewStepId = await fetchReviewStepId();\r\n                    console.debug(`Review step id: ${reviewStepId}`);\r\n                    }\r\n\r\n                    if (userEnvVariable === \"prod\") {\r\n                      await transitionLanguageToReview(\r\n                        contentItem?.id,\r\n                        key,\r\n                        reviewStepId\r\n                      );\r\n                    }\r\n                    await publishLanguageVariant(contentItem?.id, key);\r\n\r\n                    processedCount++;\r\n                    continue;\r\n                  }\r\n\r\n\r\n                \r\n\r\n                \r\n                console.info(`CSV processing completed. Processed: ${processedCount}, Unprocessed: ${unprocessedCount} Unprocessed Records: ${JSON.stringify( unprocessedRecords )}` );  \r\n\r\n                resolve({\r\n                  processedCount,\r\n                  unprocessedCount,\r\n                  unprocessedRecords,\r\n                });\r\n\r\n\r\n              } else {\r\n                console.debug(`No value found for language ${key}`);\r\n              }\r\n            } //end forEach Object.entries\r\n            \r\n                 \r\n\r\n            \r\n\r\n          } //end for results\r\n        } catch (error) {\r\n          \r\n          console.error(`Error processing CSV: ${error}`);\r\n          reject(error);\r\n        } //end try\r\n      }) //async end \r\n      .on(\"error\", (error) => {\r\n        console.error(`Error reading CSV file: ${error}`); \r\n        reject(error);\r\n      });\r\n  });\r\n}","// pages/api/upload.ts\nimport { NextApiRequest, NextApiResponse } from \"next\";\nimport { IncomingForm, Fields, Files } from \"formidable\";\nimport dotenv from \"dotenv\";\nimport { processCsvFile } from \"@/utils/picklistgenerator\";\n\ndotenv.config();\n\nexport const config = {\n  api: {\n    bodyParser: false,\n    externalResolver: true,   // <- Tells Next.js this is handled manually\n  },\n  runtime: \"nodejs\", // <- Force Node.js runtime (not edge)\n};\n\ntype FileResponseType = {\n  processedCount: number;\n  unprocessedCount: number;\n  unprocessedRecords: { name: string; reason: string }[];\n};\n\nconst parseForm = (\n  req: NextApiRequest\n): Promise<{ fields: Fields; files: Files }> => {\n  const form = new IncomingForm();\n\n  return new Promise((resolve, reject) => {\n    form.parse(req, (err, fields, files) => {\n      console.log(\"üì• Inside form.parse()\");\n      if (err) {\n        console.error(\"‚ùå Error during form parsing:\", err);\n        return reject(err);\n      }\n      resolve({ fields, files });\n    });\n  });\n};\n\nconst uploadHandler = async (req: NextApiRequest, res: NextApiResponse) => {\n  console.log(\"Received request method:\", req.method);\n  if (req.method !== \"POST\") {\n    return res.status(405).json({ message: \"Method Not Allowed\" });\n  }\n\n  try {\n    const { files, fields } = await parseForm(req);\n\n    if (!files.file) {\n      return res.status(400).json({ message: \"No file uploaded\" });\n    }\n\n    const uploadedFile = Array.isArray(files.file) ? files.file[0] : files.file;\n\n    if (!uploadedFile.filepath) {\n      return res.status(400).json({ message: \"Invalid file upload\" });\n    }\n    const userEnvVariable = fields.environment as string[];\n    const type = fields.type as string[];\n    const file = uploadedFile.filepath; // Ensure `filepath` is correct for your version\n    const response: FileResponseType = (await processCsvFile(\n      file,\n      userEnvVariable[0],\n      type[0]\n    )) as FileResponseType;\n    return res.status(200).json({\n      message: `File processed successfully`,\n      processedCount: response.processedCount,\n      unprocessedCount: response.unprocessedCount,\n      unprocessedRecords: response.unprocessedRecords,\n    });\n  } catch (error) {\n    console.error(\"‚ùå Error processing upload:\", error);\n    const errorMsg = error instanceof Error ? error.message : \"Error processing file\";\n    return res.status(500).json({ message: errorMsg });\n  }\n};\n\nexport default uploadHandler;\n","import type { NextApiResponse } from '../../types'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\n\nimport { sendError } from '../../server/api-utils'\nimport { RouteKind } from '../../server/route-kind'\nimport type { Span } from '../../server/lib/trace/tracer'\nimport { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getTracer, SpanKind } from '../../server/lib/trace/tracer'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport type { InstrumentationOnRequestError } from '../../server/instrumentation/types'\nimport { addRequestMeta } from '../../server/request-meta'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nconst routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n})\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil?: (prom: Promise<void>) => void\n  }\n): Promise<void> {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  }\n\n  const prepareResult = await routeModule.prepare(req, res, { srcPage })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return\n  }\n\n  const { query, params, prerenderManifest, routerServerContext } =\n    prepareResult\n\n  try {\n    const method = req.method || 'GET'\n    const tracer = getTracer()\n\n    const activeSpan = tracer.getActiveScopeSpan()\n    const onRequestError =\n      routeModule.instrumentationOnRequestError.bind(routeModule)\n\n    const invokeRouteModule = async (span?: Span) =>\n      routeModule\n        .render(req, res, {\n          query: {\n            ...query,\n            ...params,\n          },\n          params,\n          allowedRevalidateHeaderKeys: process.env\n            .__NEXT_ALLOWED_REVALIDATE_HEADERS as any as string[],\n          multiZoneDraftMode: Boolean(process.env.__NEXT_MULTI_ZONE_DRAFT_MODE),\n          trustHostHeader: process.env\n            .__NEXT_TRUST_HOST_HEADER as any as boolean,\n          // TODO: get this from from runtime env so manifest\n          // doesn't need to load\n          previewProps: prerenderManifest.preview,\n          propagateError: false,\n          dev: routeModule.isDev,\n          page: 'VAR_DEFINITION_PAGE',\n\n          internalRevalidate: routerServerContext?.revalidate,\n\n          onError: (...args: Parameters<InstrumentationOnRequestError>) =>\n            onRequestError(req, ...args),\n        })\n        .finally(() => {\n          if (!span) return\n\n          span.setAttributes({\n            'http.status_code': res.statusCode,\n            'next.rsc': false,\n          })\n\n          const rootSpanAttributes = tracer.getRootSpanAttributes()\n          // We were unable to get attributes, probably OTEL is not enabled\n          if (!rootSpanAttributes) {\n            return\n          }\n\n          if (\n            rootSpanAttributes.get('next.span_type') !==\n            BaseServerSpan.handleRequest\n          ) {\n            console.warn(\n              `Unexpected root span type '${rootSpanAttributes.get(\n                'next.span_type'\n              )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n            )\n            return\n          }\n\n          const route = rootSpanAttributes.get('next.route')\n          if (route) {\n            const name = `${method} ${route}`\n\n            span.setAttributes({\n              'next.route': route,\n              'http.route': route,\n              'next.span_name': name,\n            })\n            span.updateName(name)\n          } else {\n            span.updateName(`${method} ${srcPage}`)\n          }\n        })\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await invokeRouteModule(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          invokeRouteModule\n        )\n      )\n    }\n  } catch (err) {\n    // we re-throw in dev to show the error overlay\n    if (routeModule.isDev) {\n      throw err\n    }\n    // this is technically an invariant as error handling\n    // should be done inside of api-resolver onError\n    sendError(res as NextApiResponse, 500, 'Internal Server Error')\n  } finally {\n    // We don't allow any waitUntil work in pages API routes currently\n    // so if callback is present return with resolved promise since no\n    // pending work\n    ctx.waitUntil?.(Promise.resolve())\n  }\n}\n"],"names":["sendError","RouteKind","PagesAPIRouteModule","hoist","userland","getTracer","SpanKind","BaseServerSpan","addRequestMeta","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","query","params","prerenderManifest","routerServerContext","method","tracer","activeSpan","getActiveScopeSpan","onRequestError","instrumentationOnRequestError","bind","invokeRouteModule","span","render","allowedRevalidateHeaderKeys","__NEXT_ALLOWED_REVALIDATE_HEADERS","multiZoneDraftMode","Boolean","__NEXT_MULTI_ZONE_DRAFT_MODE","trustHostHeader","__NEXT_TRUST_HOST_HEADER","previewProps","preview","propagateError","dev","internalRevalidate","revalidate","onError","args","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","withPropagatedContext","headers","trace","spanName","SERVER","attributes","url","err"],"mappings":"2ZAEA,AAFA,EAAA,CAAA,CAAA,MAEA,OAAM,CAAC,MAAM,GAWb,IAAM,EAAiB,CACrB,UACE,CAAqB,SAApB,QAAQ,GAAG,CAAC,GAAG,CACZ,QAAQ,GAAG,CAAC,uBAAuB,CACnC,QAAQ,GAAG,CAAC,sBAAA,AAAsB,GAAK,GAC7C,OACE,CAAqB,SAApB,QAAQ,GAAG,CAAC,GAAG,CACZ,QAAQ,GAAG,CAAC,+BAA+B,CAC3C,QAAQ,GAAG,CAAC,8BAAA,AAA8B,GAAK,GACrD,eACE,CAAqB,SAApB,QAAQ,GAAG,CAAC,GAAG,CACZ,QAAQ,GAAG,CAAC,6BAA6B,CACzC,QAAQ,GAAG,CAAC,4BAA4B,AAA5B,GAAiC,GACnD,QACE,AAAC,CAAoB,iBAAZ,GAAG,CAAC,GAAG,CACZ,QAAQ,GAAG,CAAC,qBAAqB,CACjC,QAAQ,GAAG,CAAC,oBAAA,AAAoB,GAAK,GAC3C,mBACE,CAAqB,SAApB,QAAQ,GAAG,CAAC,GAAG,CACZ,QAAQ,GAAG,CAAC,8BAA8B,CAC1C,QAAQ,GAAG,CAAC,6BAAA,AAA6B,GAAK,6BACpD,oBAAqB,QAAQ,GAAG,CAAC,qBAAqB,EAAI,EAC5D,EAEe,SAAS,IAEtB,OADA,EAAA,CAAA,CAAA,MAAc,cAAc,CAAC,YAAa,CAAC,cAAc,EAAE,KAAK,SAAS,CAAC;AAAA,AAAS,CAAA,CAAG,CAC/E,CACT,yQCxCA,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,IACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,wCAGA,EAAA,OAAM,CAAC,MAAM,GAmBb,IAAM,EAAiB,QAAQ,GAAG,CAAC,sBAAsB,EAAI,GACvD,EAAkB,QAAQ,GAAG,CAAC,uBAAuB,EAAI,GAEzD,EAAiB,CAAA,EAAA,EAAA,OAAgB,AAAhB,IASjB,EAA2B,CAC/B,QAAW,CAAE,SAAU,UAAW,GAAI,sCAAuC,EAC7E,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,EACzE,QAAS,CAAE,SAAU,QAAS,GAAI,sCAAuC,CAC3E,EAUA,eAAe,EACb,CAA2B,CAC3B,CAAkB,EAElB,GAAI,CACF,QAAQ,IAAI,CAAC,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,gBAAgB,EAAE,EAAoB,mBAAmB,EAAE,EAAA,CAAY,EAC1H,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,gBAAgB,EAAE,EAAoB,mBAAmB,EAAE,EAAA,CAAY,CAC7G,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,KAAK,CAAC,CAAC,oCAAoC,EAAE,EAAW,iBAAiB,EAAE,EAAoB,YAAY,EAAE,KAAK,SAAS,CAAC,EAAS,IAAI,EAAA,CAAG,EAC7I,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAGd,GADY,AACR,EAAI,QAAQ,EAAE,SAAW,IAE3B,CAFgC,MAChC,QAAQ,KAAK,CAAC,CAAC,8BAA8B,EAAE,EAAW,iBAAiB,EAAE,EAAoB,2DAA2D,CAAC,EACtJ,IAKT,OAFE,QAAQ,KAAK,CAAC,CAAC,4CAA4C,EAAE,EAAW,iBAAiB,EAAE,EAAoB,EAAE,EAAE,EAAA,CAAO,EAEtH,CACR,CACF,CAEA,IAJiB,WAIF,EACb,AAL4B,CAKd,CACd,CAAkB,EAElB,GAAI,CACF,QAAQ,KAAK,CAAC,CAAC,sDAAsD,EAAE,EAAW,SAAS,EAAE,EAAA,CAAQ,EACrG,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,mBAAmB,EAAE,EAAW,YAAY,CAAC,CACnG,CAAC,EACD,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,qDAAqD,EAAE,EAAW,SAAS,EAAE,EAAA,CAAQ,EAC5F,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAGd,MAFA,QAAQ,KAAK,CAAC,CAAC,4DAA4D,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAA,CAAO,EAE/G,CACR,CACF,CAEA,eAAe,EACb,CAAc,CACd,CAAkB,CAClB,CAGG,EAEH,GAAI,CACF,IAAM,IAA+B,GACrC,QADqB,AACb,KAAK,CAAC,CAAC,2BAA2B,EAAE,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,UAAU,EAAE,GAAc,GAAA,CAAI,EAE7H,IAAM,EAAc,CAClB,SACG,CACL,EACA,QAAQ,IAAI,CAAC,CAAC,uCAAuC,EAAE,EAAW,SAAS,EAAE,EAAO,gBAAgB,EAAE,KAAK,SAAS,CAAC,GAAA,CAAc,EAEnI,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,UAAU,EAAE,GAAc,GAAA,CAAI,CACpF,EACA,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,sCAAsC,EAAE,EAAW,SAAS,EAAE,EAAA,CAAQ,EAC7E,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,CAAC,6CAA6C,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAA,CAAO,EAChG,CACR,CACF,CAEA,eAAe,EAAgB,CAA2B,EACxD,GAAI,CAEF,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,gBAAgB,EAAE,EAAA,CAAqB,CAC7E,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CACxC,AAD0C,CAE5C,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,iCAAiC,EAAE,EAAoB,SAAS,EAAE,EAAS,IAAI,CAAC,EAAE,CAAA,CAAE,EAC3F,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,CAAC,yCAAyC,EAAE,EAAoB,EAAE,EAAE,EAAA,CAAO,EACnF,CACR,CACF,CAEA,IAJiB,WAIF,EAJe,AAIG,CAAgB,CAAE,CAAoB,EACrE,GAAI,CACF,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,IAAI,CAC/B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,MAAM,CAAC,CAC7C,CACE,KAAM,EACN,SAAU,EACV,KAAM,CAAE,SAAU,EAAO,mBAAmB,AAAC,CAC/C,EACA,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,qBAAqB,EAAE,EAAa,UAAU,EAAE,EAAS,IAAI,CAAC,EAAE,CAAA,CAAE,EACzE,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAMd,MALM,EAAA,OAAK,CAAC,YAAY,CAAC,GACrB,KAD6B,GACrB,KAAK,CAAC,CAAC,4BAA4B,EAAE,EAAa,EAAE,EAAE,EAAM,OAAO,CAAC,SAAS,EAAE,EAAM,QAAQ,EAAE,OAAO,WAAW,EAAE,KAAK,SAAS,CAAC,EAAM,QAAQ,EAAE,KAAM,KAAM,GAAA,CAAI,EAE1K,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,EAAa,EAAE,EAAE,EAAA,CAAO,EAEnE,CACR,CACF,CAEA,eAAe,EACb,CAAc,CACd,CAAkB,CAClB,CAGG,EAEH,GAAI,CACF,IAAM,IAA+B,GACrC,QADqB,AACb,KAAK,CAAC,CAAC,qCAAqC,EAAE,GAAc,GAAG,SAAS,EAAE,EAAO,gBAAgB,EAAE,KAAK,SAAS,CAAC,GAAA,CAAW,EAErI,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,UAAU,EAAE,GAAc,GAAA,CAAI,CACpF,UACE,CACF,EACA,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,oCAAoC,EAAE,EAAW,SAAS,EAAE,EAAA,CAAQ,EAC3E,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAMd,MALM,EAAA,OAAK,CAAC,YAAY,CAAC,GACrB,KAD6B,GACrB,KAAK,CAAC,CAAC,2CAA2C,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAM,OAAO,CAAC,SAAS,EAAE,EAAM,QAAQ,EAAE,OAAO,WAAW,EAAE,KAAK,SAAS,CAAC,EAAM,QAAQ,EAAE,KAAM,KAAM,GAAA,CAAI,EAEzM,QAAQ,KAAK,CAAC,CAAC,2CAA2C,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAA,CAAO,EAElG,CACR,CACF,CAEA,eAAe,IACb,GAAI,CAYF,GAAM,MAAE,CAAI,CAAE,CAVG,EAUA,IAVM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,UAAU,CAAC,CACjD,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GASI,EAAa,AAJK,EAAK,MAAM,CAChC,AAAD,GAA4C,YAAf,EAAE,QAAQ,CAGP,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,CAChD,AAAC,GAA2C,AAAf,aAAE,QAAQ,EAGzC,OAAO,CAAU,CAAC,EAAE,EAAE,EACxB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,CAAC,+BAA+B,EAAE,EAAA,CAAO,EACjD,CACR,CACF,CAEA,eAAe,EACb,CAAc,CACd,CAAkB,CAClB,CAAoB,EAGpB,GAAI,CACF,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,mBAAmB,EAAE,EAAW,gBAAgB,CAAC,CACvG,CACE,oBAAqB,CACnB,SAAU,SACZ,EACA,gBAAiB,CACf,GAAI,CACN,CACF,EACA,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CACxC,AAD0C,CAE5C,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,EAAW,SAAS,EAAE,EAAO,eAAe,CAAC,EACjG,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAEd,MADA,QAAQ,KAAK,CAAC,CAAC,kDAAkD,EAAE,EAAW,SAAS,EAAE,EAAO,iBAAiB,EAAE,EAAA,CAAO,EACpH,CACR,CACF,CAEA,eAAe,EAAuB,CAAc,CAAE,CAAkB,EACtE,GAAI,CACF,IAAM,EAAW,MAAM,EAAA,OAAK,CAAC,GAAG,CAC9B,CAAA,EAAG,EAAO,OAAO,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,OAAO,EAAE,EAAO,mBAAmB,EAAE,EAAW,QAAQ,CAAC,CAC/F,CAAC,EACD,CACE,QAAS,CACP,eAAgB,mBAChB,cAAe,CAAC,OAAO,EAAE,EAAO,MAAM,CAAA,CAAE,AAC1C,CACF,GAGF,OADA,QAAQ,IAAI,CAAC,CAAC,wCAAwC,EAAE,EAAW,SAAS,EAAE,EAAA,CAAQ,EAC/E,EAAS,IAAI,AACtB,CAAE,MAAO,EAAO,CAOd,MANM,EAAA,OAAK,CAAC,YAAY,CAAC,GACrB,KAD6B,GACrB,KAAK,CAAC,CAAC,+CAA+C,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAM,OAAO,CAAC,SAAS,EAAE,EAAM,QAAQ,EAAE,OAAO,WAAW,EAAE,KAAK,SAAS,CAAC,EAAM,QAAQ,EAAE,KAAM,KAAM,GAAA,CAAI,EAG7M,QAAQ,KAAK,CAAC,CAAC,+CAA+C,EAAE,EAAW,SAAS,EAAE,EAAO,EAAE,EAAE,EAAA,CAAO,EAEtG,CACR,CACF,CAIA,SAAS,EAAoB,CAAW,CAAE,CAAsB,EAC9D,MAAO,CACL,CACE,QAAS,CAAE,SAAU,OAAQ,EAC7B,MAAO,CAAG,CAAC,EAAe,EAAI,EAAI,CAAD,MAAW,EAAI,EAClD,EAEJ,AADG,CAwBH,SAAS,EAAmB,CAA6B,EACvD,OAAO,OAAO,MAAM,CAAC,GAAU,IAAI,CAAC,AAAC,IACnC,IAAM,EAAQ,GAAS,aAEnB,AAAJ,MAAU,OAAO,CAAC,GACT,EAAM,GADW,GACL,CAAG,EAGH,UAAjB,AAA2B,OAApB,GACF,EAAM,IAAI,GAAG,MAAM,CAAG,CAIjC,EACF,CAEO,eAAe,EACpB,CAAgB,CAChB,CAAuB,CACvB,CAAY,EAGZ,QAAQ,IAAI,CAAC,CAAC,qBAAqB,EAAE,EAAA,CAAU,EAE/C,IAAM,EAAoB,EAAE,CACtB,EAAY,OAAO,IAAI,CAAC,GAE9B,EAAO,SAAS,CACM,SAApB,EAA6B,EAAkB,EAEjD,EAAO,mBAAmB,CAAG,EAE7B,IAAI,EAAiB,EAEf,EAAyD,EAAE,CAEjE,OAAO,IAAI,QAAQ,CAAC,EAAS,KAC3B,EAAA,OAAE,CAAC,gBAAgB,CAAC,GACjB,IAAI,CAAC,CAAA,EAAA,EAAA,OAAA,AAAG,EAAC,CAAE,QAAS,CAAU,IAC9B,EAAE,CAAC,OAAQ,AAAC,GAAgB,EAAQ,IAAI,CAAC,IACzC,EAAE,CAAC,MAAO,UACT,GAAI,CACF,IAAK,IAAI,EAAI,EAAG,EAAI,EAAQ,MAAM,CAAE,IAAK,CACvC,IAAM,EAAM,CAAO,CAAC,EAAE,CAItB,IAAK,GAAM,CAAC,EAAc,EAAM,GAHhC,QAAQ,KAAK,CAAC,CAAC,4BAA4B,EAAE,OAAO,IAAI,CAAC,GAAK,IAAI,CAAC,MAAA,CAAO,EAGtC,OAAO,OAAO,CAAC,IAAM,CACvD,GAAI,CAAC,GAAO,OAAQ,SACpB,IAAM,EAAM,EAAa,IAAI,GAE7B,GAAY,YAAY,CAApB,EAMJ,GAJA,IAFkC,IAE1B,KAAK,CAAC,CAAC,kBAAkB,EAAE,EAAI,aAAa,EAAE,EAAM,IAAI,CAFyB,EAEzB,CAAI,EAIhE,GAA0B,AAAjB,OAAM,IAAI,GAAW,CAChC,QAAQ,KAAK,CAAC,CAAC,qCAAqC,EAAE,EAAI,aAAa,EAAE,EAAM,IAAI,GAAA,CAAI,EAEvF,IAAM,EAAW,EAAM,IAAI,GACrB,EAAe,CAAA,EAAG,EAAK,CAAC,EAxErC,AAwEuC,AAAW,EAvEtD,IAAI,GACJ,WAAW,GACX,OAAO,CAAC,QAAS,KAAY,AAC7B,OAAO,CAAC,IADiC,EAC1B,KAAY,AAC3B,OAAO,CAAC,IAD+B,OACnB,KACpB,AAD6B,OACtB,CAAC,cAD2C,AAC5B,IAkE+B,CAlExB,AAkEmC,CAEhD,EAAc,MAAM,EAAgB,GAGxC,GAAmB,MAAf,GAAsC,IAvEK,IAuEpB,EAA0B,CACnD,QAAQ,KAAK,CAAC,CAAC,2BAA2B,EAAE,EAAa,2BAA2B,EAAE,KAAK,SAAS,CAAC,GAAA,CAAc,EAEnH,IAAM,EAAiB,MAAM,EAC3B,EACA,GAGE,EAAe,KAKnB,IAAK,IAAM,KAJa,QAAQ,CAA5B,IACF,EAAe,MAAM,IACrB,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,EAAA,CAAc,GAE1B,GAAW,CAChC,IAAM,EA/FnB,CAAW,CA+FuC,AA/FtC,EAAa,CAkGZ,GAAI,CAAC,GAAc,CAHE,GAIjB,AAA0B,YAAY,GAAzB,OAAmC,CAA3B,CADF,SAGvB,IAAM,EAAW,EAAoB,EAAK,EAAa,QAAQ,CAC/D,OAAM,EAAmB,EAAe,EAHyD,AAGvD,CAAE,EAAa,EAAE,CAAE,GACrC,QAAQ,CAA5B,GACF,MAAM,EACJ,EAAe,EAAE,CACjB,EAAa,EAAE,CACf,GAGJ,MAAM,EAAuB,EAAe,EAAE,CAAE,EAAa,EAAE,EAE/D,GACF,CACF,CADI,IAEC,CAGH,QAAQ,KAAK,CAAC,AALO,CAKN,2BAA2B,EAAE,EAAa,yBAAyB,EAAE,EAAY,EAAE,CAAC,YAAY,EAAE,KAAK,SAAS,CAAC,GAAA,CAAc,EAC9I,IAAM,EAAW,EAAoB,EAAK,GAEtC,EAAqB,MAAM,EAC7B,GAAa,SACb,EAGsB,OAApB,QAAgD,GAApB,EAC1B,EAAmB,IACrB,AAF2D,MAErD,CAD0B,CACP,GAAa,GAAI,EAAK,GAI7C,EAAmB,KACrB,MADgC,AAC1B,EACJ,GAAa,GACb,GAEF,MAAM,EAAsB,GAAa,GAAI,EAAK,IAItD,IAAI,EAAe,KACK,QAAQ,CAA5B,IACJ,EAAe,MAAM,IACrB,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,EAAA,CAAc,GAGvB,QAAQ,CAA5B,GACF,MAAM,EACJ,GAAa,GACb,EACA,GAGJ,MAAM,EAAuB,GAAa,GAAI,GAE9C,IACA,QACF,CAMF,QAAQ,IAAI,CAAC,CAAC,qCAAqC,EAAE,eAAe,eAAe,EAAE,UAAyC,KAAK,EAA7B,OAAsC,CAAE,IAAsB,EAEpK,EAAQ,MAFoH,UAG1H,EACA,iBAxHO,EAyHP,oBACF,EAGF,MACE,CADK,OACG,KAAK,CAAC,CAAC,4BAA4B,EAAE,EAAA,CAAK,CAEtD,CAMF,CANI,AAON,CADI,AACF,MAAO,EAAO,CAEd,QAHmB,AAGX,KAAK,CAAC,CAAC,GATiB,mBASK,EAAE,EAAA,CAAO,EAC9C,EAAO,EACT,CACF,CADI,EACD,AACF,EAAE,CAAC,IAFS,IAEA,AAAC,CADC,GAEb,QAAQ,KAAK,CAAC,CAAC,wBAAwB,EAAE,EAAA,CAAO,EAChD,EAAO,EACT,EACJ,EACF,oFCjhBA,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,4CAEA,EAAA,OAAM,CAAC,MAAM,GAiCb,IAAM,EAAgB,MAAO,EAAqB,KAEhD,GADA,QAAQ,GAAG,CAAC,2BAA4B,EAAI,MAAM,EAC9C,AAAe,QAAQ,GAAnB,MAAM,CACZ,OAAO,EAAI,MAAM,CAAC,KAAK,IAAI,CAAC,CAAE,QAAS,oBAAqB,GAG9D,GAAI,OACI,CAAE,OAAK,QAAE,CAAM,CAAE,CAAG,MAAM,CArB5B,EAAO,IAAI,EAAA,YAAY,CAEtB,IAAI,QAAQ,CAAC,EAAS,KAC3B,EAAK,KAAK,CAAC,AAkB+B,EAlB1B,CAAC,EAAK,EAAQ,KAE5B,GADA,QAAQ,GAAG,CAAC,0BACR,EAEF,GAFO,IACP,QAAQ,KAAK,CAAC,+BAAgC,GACvC,EAAO,GAEhB,EAAQ,QAAE,QAAQ,CAAM,EAC1B,EACF,IAYE,GAAI,CAAC,EAAM,IAAI,CACb,CADe,MACR,EAAI,MAAM,CAAC,KAAK,IAAI,CAAC,CAAE,QAAS,kBAAmB,GAG5D,IAAM,EAAe,MAAM,OAAO,CAAC,EAAM,IAAI,EAAI,EAAM,IAAI,CAAC,EAAE,CAAG,EAAM,IAAI,CAE3E,GAAI,CAAC,EAAa,QAAQ,CACxB,CAD0B,MACnB,EAAI,MAAM,CAAC,KAAK,IAAI,CAAC,CAAE,QAAS,qBAAsB,GAE/D,IAAM,EAAkB,EAAO,WAAW,CACpC,EAAO,EAAO,IAAI,CAClB,EAAO,EAAa,QAAQ,CAC5B,CAD8B,CACA,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,EACtD,EACA,CAAe,CAAC,EAAE,CAClB,CAAI,CAAC,EAAE,EAET,OANoF,AAM7E,EAAI,MAAM,CAAC,KAAK,IAAI,CAAC,CAC1B,QAAS,CAAC,2BAA2B,CAAC,CACtC,eAAgB,EAAS,cAAc,CACvC,iBAAkB,EAAS,gBAAgB,CAC3C,mBAAoB,EAAS,kBAC/B,AADiD,EAEnD,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,6BAA8B,GAC5C,IAAM,EAAW,aAAiB,MAAQ,EAAM,OAAO,CAAG,wBAC1D,OAAO,EAAI,MAAM,CAAC,KAAK,IAAI,CAAC,CAAE,QAAS,CAAS,EAClD,CACF,kBApEsB,CACpB,IAAK,CACH,YAAY,EACZ,kBAAkB,CACpB,EACA,QAAS,QACX,cAgEe,wDC3Ef,IAAA,EAA0B,EAAwB,CAAzCA,AAAyC,CAAA,GAAA,GAClD,EAA0B,AADR,EACiC,CAA1CC,AAA0C,CAAA,IAAA,AADzB,EAG1B,EAFkB,AAEkB,EAAA,CAA3BC,AAA2B,CAAA,IAFV,EAI1B,EAAiC,EAAA,CAAA,AAAxBC,CAAwB,IAAnB,EAGd,AAL4B,EAKY,EAAA,CAAA,AALkD,CAEpE,AAGkB,EAA5BC,AALwB,IAMpC,EAAoC,EAAA,CAA3BC,AAA2B,CAA+B,AAJlC,IAGP,EAE1B,EADkB,AACa,EADXC,AAC6C,CAAxDC,AAAwD,CAAA,MADrC,AAG5B,CAJwC,CAIT,EAA2B,CAAA,AAAjDC,CAAiD,CAFnC,CADa,OACL,EAE2B,EAAnC,QAAQ,4BAGhBL,EAAAA,KAAAA,EAAMC,EAAU,WAAU,AAG5BK,EAAAA,CAAAA,EAASN,EAAAA,KAAAA,EAAMC,EAAU,UAAS,AAGzCM,EAAc,IAAIR,EAAAA,mBAAAA,CAAoB,CAC1CS,WAAY,CACVC,KAAMX,EAAAA,SAAAA,CAAUY,SAAS,CACzBC,KAAM,sBACNC,SAAU,sBAEVC,WAAY,GACZC,SAAU,EACZ,WACAb,EACAc,QAAqBG,CAAZF,EAAoC,KAC7CG,CADiBF,GAAG,AAA6B,CAA5BC,cAC0C,CAA3CF,CACtB,GAEO,IAHuBC,GAAG,CAACG,OAGZC,EACpBC,CAAoB,CACpBC,CAAmB,CACnBC,CAEC,EAEGjB,EAAYkB,KAAK,EAAE,EAVoC,CAWzDpB,EAAAA,cAAAA,EAAeiB,EAAK,+BAAgCN,QAAQU,MAAM,CAACC,MAAM,IAE3E,IAAIC,EAAU,sBAMZA,EAAUA,EAAQE,OAAO,CAAC,WAAY,KAAO,IAG/C,IAAMC,EAAgB,MAAMxB,EAAYyB,OAAO,CAACV,EAAKC,EAAK,SAAEK,CAAQ,GAEpE,GAAI,CAACG,EAAe,CAClBR,EAAIU,UAAU,CAAG,IACjBV,EAAIW,GAAG,CAAC,eACK,MAAbV,CAAa,CAATW,IAAS,KAAA,EAAbX,EAAIW,SAAS,CAAA,IAAA,CAAbX,EAAgBY,QAAQC,OAAO,IAC/B,MACF,CAEA,GAAM,OAAEC,CAAK,CAAEC,QAAM,mBAAEC,CAAiB,qBAAEC,CAAmB,CAAE,CAC7DV,EAEF,GAAI,CACF,IAAMW,EAASpB,EAAIoB,MAAM,EAAI,MACvBC,EAAAA,CAAAA,EAASzC,EAAAA,SAAAA,IAET0C,EAAaD,EAAOE,kBAAkB,GACtCC,EACJvC,EAAYwC,6BAA6B,CAACC,IAAI,CAACzC,GAE3C0C,EAAoB,MAAOC,GAC/B3C,EACG4C,MAAM,CAAC7B,EAAKC,EAAK,CAChBe,MAAO,CACL,GAAGA,CAAK,CACR,GAAGC,CAAM,AACX,SACAA,EACAa,2BAAAA,CACGC,CAD0BrC,CAC1BqC,CACHC,MAFqCrC,GAAG,AACJ,CAAjCoC,SACqCG,CAAAA,AAApBD,EACpBE,KADoE,CAAxCzC,QAAQC,CACpCwC,CACGC,CADc1C,AACd0C,AAFoC,CAACF,CAKxCG,CAH2B,KADF1C,GAAG,CACzByC,GAGWlB,EAAkBoB,OAAO,CACvCC,gBAAgB,EAChBC,IAAKvD,EAAYkB,KAAK,CACtBd,KAAM,sBAENoD,kBAAkB,CAAEtB,MAAAA,EAAAA,KAAAA,EAAAA,EAAqBuB,UAAU,CAEnDC,QAAS,CAAC,GAAGC,IACXpB,EAAexB,KAAQ4C,EAC3B,GACCC,OAAO,CAAC,KACP,GAAI,CAACjB,EAAM,OAEXA,EAAKkB,aAAa,CAAC,CACjB,mBAAoB7C,EAAIU,UAAU,CAClC,WAAY,EACd,GAEA,IAAMoC,EAAqB1B,EAAO2B,qBAAqB,GAEvD,GAAI,CAACD,EACH,OAGF,GACEA,EAAmBE,GAAG,CAAC,EALA,kBAMvBnE,EAAAA,cAAAA,CAAeoE,aAAa,CAC5B,YACAC,QAAQC,IAAI,CACV,CAAC,2BAA2B,EAAEL,EAAmBE,GAAG,CAClD,kBACA,qEAAqE,CAAC,EAK5E,IAAMI,EAAQN,EAAmBE,GAAG,CAAC,cACrC,GAAII,EAAO,CACT,IAAMC,EAAO,CAAA,EAAGlC,EAAO,CAAC,EAAEiC,EAAAA,CAAO,CAEjCzB,EAAKkB,aAAa,CAAC,CACjB,aAAcO,EACd,aAAcA,EACd,iBAAkBC,CACpB,GACA1B,EAAK2B,UAAU,CAACD,EAClB,MACE1B,CADK,CACA2B,UAAU,CAAC,CAAA,EAAGnC,EAAO,CAAC,EAAEd,EAAAA,CAAS,CAE1C,GAIAgB,EACF,MAAMK,EAAkBL,EADV,CAGd,MAAMD,EAAOmC,qBAAqB,CAACxD,EAAIyD,OAAO,CAAE,IAC9CpC,EAAOqC,KAAK,CACV5E,EAAAA,cAAAA,CAAeoE,aAAa,CAC5B,CACES,SAAU,CAAA,EAAGvC,EAAO,CAAC,EAAEd,EAAAA,CAAS,CAChCnB,KAAMN,EAAAA,QAAAA,CAAS+E,MAAM,CACrBC,WAAY,CACV,cAAezC,EACf,cAAepB,EAAI8D,GAAG,AACxB,CACF,EACAnC,GAIR,CAAE,MAAOoC,EAAK,CAEZ,GAAI9E,EAAYkB,KAAK,CACnB,CADqB,KACf4D,KAIRxF,EAAAA,SAAAA,EAAU0B,EAAwB,IAAK,wBACzC,QAAU,CAIK,MAAbC,CAAa,CAATW,IAAS,KAAA,EAAbX,EAAIW,SAAS,CAAA,IAAA,CAAbX,EAAgBY,QAAQC,OAAO,GACjC,CACF","ignoreList":[3]}