"use strict";(()=>{var e={};e.id=164,e.ids=[164],e.modules={1428:e=>{e.exports=import("axios")},1742:e=>{e.exports=import("csv-parse/sync")},3480:(e,t,r)=>{e.exports=r(5600)},3873:e=>{e.exports=require("path")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5751:e=>{e.exports=require("xlsx")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8015:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>m});var s=r(1428),o=r(5751),a=r(9021),i=r.n(a),l=r(3873),u=r.n(l),p=r(1742),d=e([s,p]);async function m(e,t){let r;if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let{environment:n,queryParams:a,language:l="default"}=e.body;if(!n||!["dev","prod"].includes(n))return t.status(400).json({error:"Invalid or missing environment"});let d=a?.["system.type"];if(!d||""===d.trim())return t.status(400).json({error:"Please select a list (system.type) to export."});let m=process.env[`KONTENT_${n.toUpperCase()}_PROJECT_ID`],c=process.env[`KONTENT_${n.toUpperCase()}_DELIVERY_BASE_URL`]||"https://deliver.kontent.ai",f=process.env[`KONTENT_${n.toUpperCase()}_DELIVERY_API_KEY`];if(!m||!f||!c)return t.status(500).json({error:"Missing environment config"});let h=e.body.apiUrl||`${c}/${m}/items`,_=[];try{for(;;){let e={Authorization:`Bearer ${f}`};r&&(e["x-continuation"]=r);let n={...a,language:l,depth:2};console.log("Final queryParams:",n);let o=u().resolve("./data/DiningItemList.csv"),d=[];try{let e=i().readFileSync(o,"utf-8");d=(0,p.parse)(e,{columns:!1,skip_empty_lines:!0,trim:!0}).flat()}catch(e){return t.status(500).json({error:"Failed to read or parse local CSV"})}if(!d.length)return t.status(400).json({error:"No names found in CSV"});console.log("Name List Length: ",d.length);let m=(await s.default.get(h,{params:n,headers:e})).data;if(!m.items||0===m.items.length)break;for(let e of m.items){let t=e.system?.type;t&&t===a["system.type"]&&e.elements&&("template_dining"===t?_.push({Name:e.elements.name?.value||"",Cuisine:e.elements.cuisine?.value?.join(", ")||"","Price Rating":e.elements.price_rating?.value?.join(", ")||"",Atmosphere:e.elements.atmosphere?.value?.join(", ")||"","Dress Code":e.elements.dress_code?.value?.join(", ")||""}):_.push({Name:e.elements.name?.value||""}))}if(!(r=m.continuationToken))break}if(0===_.length)return t.status(404).json({error:"No data found"});let e=o.utils.json_to_sheet(_),d=o.utils.book_new();o.utils.book_append_sheet(d,e,"Data");let m=o.write(d,{type:"buffer",bookType:"xlsx"}),c=a["system.type"]?.replace(/[\\/:*?"<>|]/g,"_")||"data",y=`Monarch_${n}_${c}.xlsx`;t.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),t.setHeader("Content-Disposition",`attachment; filename="${y}"`),t.status(200).send(m)}catch(e){return console.error("API Error:",e?.response?.data||e.message||e),t.status(500).json({error:"Failed to fetch or process data"})}}[s,p]=d.then?(await d)():d,n()}catch(e){n(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")},9968:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>u,routeModule:()=>d});var s=r(3480),o=r(8667),a=r(6435),i=r(8015),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,a.M)(i,"default"),p=(0,a.M)(i,"config"),d=new s.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/exportTemplateDining",pathname:"/api/exportTemplateDining",bundlePath:"",filename:""},userland:i});n()}catch(e){n(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9968);module.exports=r})();