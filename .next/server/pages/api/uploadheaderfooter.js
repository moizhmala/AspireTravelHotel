"use strict";(()=>{var e={};e.id=114,e.ids=[114],e.modules={272:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(818);a.n(n)().config();let r={projectId:("prod"===process.env.ENV?process.env.KONTENT_PROD_PROJECT_ID:process.env.KONTENT_DEV_PROJECT_ID)||"",apiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_MANAGEMENT_API_KEY:process.env.KONTENT_DEV_MANAGEMENT_API_KEY)||"",deliveryApiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_API_KEY:process.env.KONTENT_DEV_DELIVERY_API_KEY)||"",baseUrl:("prod"===process.env.ENV?process.env.KONTENT_PROD_BASE_URL:process.env.KONTENT_DEV_BASE_URL)||"",_DELIVERY_BASE_URL:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_BASE_URL:process.env.KONTENT_DEV_DELIVERY_BASE_URL)||"https://deliver.kontent.ai",contentTypeCodename:process.env.CONTENT_TYPE_CODENAME||""};function i(){return a(9021).appendFileSync("debug.txt",`Using config: ${JSON.stringify(r)}
`),r}},451:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{h:()=>w});var r=a(9021),i=a.n(r);a(7048);var o=a(1428),s=a(818),d=a.n(s),c=a(272),l=a(5751),p=a(471),u=e([o]);o=(u.then?(await u)():u)[0],d().config();let A=process.env.KONTENT_DEV_PROJECT_ID||"",x=process.env.KONTENT_PROD_PROJECT_ID||"",T=(0,c.A)(),N={default:{codename:"default",id:"00000000-0000-0000-0000-000000000000"},"de-DE":{codename:"de-DE",id:"79228548-6576-5a60-acad-53360bf23687"},"ja-JP":{codename:"ja-JP",id:"4e8fa49a-27d3-44a7-8135-3dc21008ddd1"},"ko-KR":{codename:"ko-KR",id:"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812"},"zh-HK":{codename:"zh-HK",id:"e832b221-cbe7-442a-8edf-98a7ac7afac6"},"zh-TW":{codename:"zh-TW",id:"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed"},"ar-AE":{codename:"ar-AE",id:"3dc9c67d-95d8-4594-890d-70f98c615fbd"},"es-MX":{codename:"es-MX",id:"0814121f-7011-4361-b7bd-cebd74fe4cd9"}};async function g(e){try{a(9021).appendFileSync("debug.txt",`Fetching element ID map for type: ${T.baseUrl}/${T.projectId}/types/codename/${e}
`);let t=await o.default.get(`${T.baseUrl}/${T.projectId}/types/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}}),n={};for(let e of t.data.elements)n[e.name.trim()]=e.id;return n}catch(t){throw p.console.error(`‚ùå Error fetching element ID map for type "${e}":`,t),t}}async function f(e){try{return(await o.default.get(`${T.baseUrl}/${T.projectId}/items/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}})).data}catch(e){return p.console.error(`Error finding content item: ${e}`),!1}}async function m(e,t){try{return a(9021).appendFileSync("debug.txt",`Finding content item variant: ${T.baseUrl}/${T.projectId}/items/${e}/variants/${t}
`),(await o.default.get(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}})).data}catch(e){return p.console.error(`Error finding content item variant: ${e}`),!1}}async function y(e,t,n){try{let n=await m(e,t);if(a(9021).appendFileSync("debug.txt",`Current workflow step for ${t}: ${n.workflow_step?.id||"N/A"}
`),n.workflow_step?.id==="eee6db3b-545a-4785-8e86-e3772c8756f9"){a(9021).appendFileSync("debug.txt",`Deleting existing draft version for: ${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}
`);let n=await o.default.delete(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}});return a(9021).appendFileSync("debug.txt",`‚úÖ Deleted existing draft version for language: ${t}
`),n.data}}catch(e){throw p.console.error(`Error deleting existing draft version: ${e}`),e}}async function $(e,t,n){try{let r=await o.default.post(`${T.baseUrl}/${T.projectId}/items`,{name:e,codename:t,type:{codename:n}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}});return a(9021).appendFileSync("debug.txt",`‚úÖ Created content item: ${t}
`),r.data}catch(e){throw a(9021).appendFileSync("debug.txt",`Error creating content item: ${e}
`),e}}async function h(e,t){try{let a=await o.default.put(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}/new-version`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}});return i().appendFileSync("debug.txt",`‚úÖ Variant new version created for language ${t}
`),a.data}catch(e){throw a(9021).appendFileSync("debug.txt",`Error creating language variant: ${e}
`),e}}async function E(e,t,n,r,i,s,d){try{a(9021).appendFileSync("debug.txt",`Adding language variant ${T.baseUrl}/${T.projectId}/items/${e}/variants/${t}
`);let c={"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${T.apiKey}`},l={elements:[...d,{element:{codename:"content_type"},value:[{codename:n}]},{element:{codename:"name"},value:r},{element:{codename:"client_availability"},value:[{codename:"client_availability_list_restricted"}]},{element:{codename:"client_id"},value:[{codename:i}]},{element:{codename:"program_id"},value:[{codename:s}]}]};a(9021).appendFileSync("debug.txt",`requestBody to add: ${JSON.stringify(l,null,2)}
`);let p=await o.default.put(`${T.baseUrl}/${T.projectId}/items/${e}/variants/${t}`,l,{headers:c});return a(9021).appendFileSync("debug.txt",`‚úÖ Variant update success for language ${t}
`),p.data}catch(e){throw o.default.isAxiosError(e)?a(9021).appendFileSync("debug.txt",`Error Adding language variant | Axios error: ${e}
`):a(9021).appendFileSync("debug.txt",`Error Adding language variant | Non-axios error: ${e}
`),e}}async function b(){try{let{data:e}=await o.default.get(`${T.baseUrl}/${T.projectId}/workflows`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}}),t=e.filter(e=>"default"===e.codename)[0].steps.filter(e=>"review"===e.codename);return t[0]?.id}catch(e){throw p.console.error(`Error publishing language variant: ${e}`),e}}async function _(e,t,a){try{return(await o.default.put(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}/change-workflow`,{workflow_identifier:{codename:"default"},step_identifier:{id:a}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${T.apiKey}`}})).data}catch(e){throw p.console.error(`Error publishing language variant: ${e}`),e}}async function v(e,t){try{new Date(Date.now()+18e5).toISOString();let n=await o.default.put(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}/publish`,{},{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${T.apiKey}`}});return a(9021).appendFileSync("debug.txt",`‚úÖ Published language variant ${t}
`),n.data}catch(e){throw a(9021).appendFileSync("debug.txt",`Error publishing language variant: ${e}
`),e}}async function S(e,t){try{let a=await o.default.get(`${T.baseUrl}/${T.projectId}/items/${e}/variants/codename/${t}`,{headers:{Authorization:`Bearer ${T.apiKey}`,"Content-Type":"application/json"}});return 200===a.status}catch(e){if(e.response?.status===404)return!1;throw e}}async function w(e,t,n){let r;p.console.log(`Processing XLSX file: ${e}`);let i=l.readFile(e),o=i.Sheets[i.SheetNames[0]],s=l.utils.sheet_to_json(o,{header:1}),d=[],c="";for(let e=3;e<s[1].length;e++){let t=s[0][e],a=s[1][e];t?.trim()&&(c=t.trim()),p.console.debug(`Processing column ${e}: Language: ${c}, Variable: ${a}`);let n=a?.trim();c&&n&&d.push({language:c,variable:n,columnIndex:e})}let u="travel_header_footer_model";T.projectId="prod"===t?x:A,T.apiKey="prod"===t?process.env.KONTENT_PROD_MANAGEMENT_API_KEY?.toString()??"":process.env.KONTENT_DEV_MANAGEMENT_API_KEY?.toString()??"",T.contentTypeCodename=n;try{r=await g(u)}catch(e){throw a(9021).appendFileSync("debug.txt","‚ùå Failed to fetch element ID map:"+e+"\n"),e}let m={};for(let[e,t]of Object.entries(r))if("string"==typeof t){let n=e.replace(/\s+/g," ").trim();a(9021).appendFileSync("debug.txt",`üîë Normalizing key: "${e}" to "${n}" with value: ${t}
`),m[n]=t}else a(9021).appendFileSync("debug.txt",`‚ö†Ô∏è Unexpected non-string value for key: ${e}`+t+"\n");let w=0,P=0,I=[];for(let e=2;e<s.length;e++){let r=s[e];if(!r[2])continue;let i=String(r[2]).trim(),o=i.replace(/\s+/g,"_").toLowerCase(),c="email_template"===n?"email":"web",l=i+" "+c.charAt(0).toUpperCase()+c.slice(1),g=`${o}_${c}`;try{let e=await f(g);a(9021).appendFileSync("debug.txt",`üîç Searching for content item: ${g}
`),e?a(9021).appendFileSync("debug.txt",`üîÑ Content item exists. Updating: ${g}
`):(a(9021).appendFileSync("debug.txt",`üîß Content item does not exist. Creating: ${g}
`),e=await $(l,g,u));let n="prod"===t?await b():null,o={},s={},A={},x={},T={};for(let{language:e,variable:t,columnIndex:n}of d){let i=r[n];a(9021).appendFileSync("debug.txt",`üìÑ Check point 1 Processing item: ${l} (${g}) | ${e.trim()} | Columnn: ${n} | Variable: ${t} 
`);let d=N[e.trim()];if(a(9021).appendFileSync("debug.txt",`üîé Processing language: "${d.codename}" | "${d.id}" and value: XXX
`),!d){a(9021).appendFileSync("debug.txt",`‚ö†Ô∏è Language not found: "${e}"
`);continue}let c=d.id,u=d.codename;s[c]=u,A[c]=r[2]+" Web",x[c]="client_id_list_"+r[1].toString().toLowerCase(),T[c]="program_id_list_"+r[2].toString().replace(/\s+/g,"_").toLowerCase();let f=t.replace(/^(Web|Email)\s+/i,"").replace(/\b(HTML|Style|Script)\b/,e=>{switch(e){case"HTML":return"HTML";case"Style":return"CSS";case"Script":return"Script";default:return e}}).replace(/\s+/g," ").trim(),y=m[f];if(!y){a(9021).appendFileSync("debug.txt",`‚ö†Ô∏è Element ID not found for variable: "${f}"
`);continue}if(!c){a(9021).appendFileSync("debug.txt",`‚ö†Ô∏è Language code not found for: "${e}"
`);continue}let $=String(i||"").trim();try{a(9021).appendFileSync("debug.txt",`üîé Processing value for variable "${f}": 
`),("Header HTML"===f||"Footer HTML"===f||"Header CSS"===f||"Footer CSS"===f)&&($=String(i||"").replace(/<!--[\s\S]*?-->/g,"").replace(/\s{2,}/g," ").replace(/\n/g,"").replace(/\r/g,"").replace(/>\s+</g,"><").replace(/\\"/g,'"').replace(/\"/,'"').trim())}catch(e){p.console.error("‚ùå Failed to write to debug.txt:",e)}o[d.id]||(o[d.id]=[]),"string"==typeof $&&$.trim().length>0&&o[c].push({element:{id:y},value:$})}for(let[r,i]of(w++,Object.entries(o))){if(0===i.length){a(9021).appendFileSync("debug.txt",`‚ö†Ô∏è No elements to process for language ID: ${r}. Skipping.
`);continue}let o=s[r];a(9021).appendFileSync("debug.txt",`üì§ Updating/Creating variant for language: ${o} with elements: 
`);let d=await S(e.id,o);a(9021).appendFileSync("debug.txt",`Variant details for language ${o}: ${JSON.stringify(d,null,2)}
`),d?(a(9021).appendFileSync("debug.txt",`üîÑ Variant exists for language: ${o}. Updating existing variant.
`),await y(e.id,o,d),await h(e.id,o)):a(9021).appendFileSync("debug.txt",`üîß Variant does not exist for language: ${o}. Creating new variant.
`),await E(e.id,r,c,A[r],x[r],T[r],i),"prod"===t&&n&&await _(e.id,o,n),await v(e.id,o)}a(9021).appendFileSync("debug.txt",`‚úÖ Successfully processed item: ${i}
`)}catch(n){let e=n?.response?.data,t=e?.validation_errors?.[0]?.message||n.message;a(9021).appendFileSync("debug.txt",`‚ùå Error processing item: ${i}: ${t}
`),I.push({name:i,reason:t}),P++}}return{processedCount:w,unprocessedCount:P,unprocessedRecords:I}}n()}catch(e){n(e)}})},471:e=>{e.exports=require("inspector")},818:e=>{e.exports=require("dotenv")},1428:e=>{e.exports=import("axios")},3480:(e,t,a)=>{e.exports=a(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5751:e=>{e.exports=require("xlsx")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7048:e=>{e.exports=require("csv-parser")},7313:e=>{e.exports=import("formidable")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8748:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>p});var r=a(3480),i=a(8667),o=a(6435),s=a(9729),d=e([s]);s=(d.then?(await d)():d)[0];let c=(0,o.M)(s,"default"),l=(0,o.M)(s,"config"),p=new r.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/uploadheaderfooter",pathname:"/api/uploadheaderfooter",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},9021:e=>{e.exports=require("fs")},9729:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>c,default:()=>p});var r=a(7313),i=a(818),o=a.n(i),s=a(451),d=e([r,s]);[r,s]=d.then?(await d)():d,o().config();let c={api:{bodyParser:!1,externalResolver:!0},runtime:"nodejs"},l=e=>{let t=new r.IncomingForm;return new Promise((a,n)=>{t.parse(e,(e,t,r)=>{if(console.log("\uD83D\uDCE5 Inside form.parse()"),e)return console.error("‚ùå Error during form parsing:",e),n(e);a({fields:t,files:r})})})},p=async(e,t)=>{if(console.log("Received request method:",e.method),"POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let{files:a,fields:n}=await l(e);if(!a.file)return t.status(400).json({message:"No file uploaded"});let r=Array.isArray(a.file)?a.file[0]:a.file;if(!r.filepath)return t.status(400).json({message:"Invalid file upload"});let i=n.environment,o=n.type,d=r.filepath,c=await (0,s.h)(d,i[0],o[0]);return t.status(200).json({message:"File processed successfully",processedCount:c.processedCount,unprocessedCount:c.unprocessedCount,unprocessedRecords:c.unprocessedRecords})}catch(a){console.error("‚ùå Error processing upload:",a);let e=a instanceof Error?a.message:"Error processing file";return t.status(500).json({message:e})}};n()}catch(e){n(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=8748);module.exports=a})();