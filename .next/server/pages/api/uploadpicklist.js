"use strict";(()=>{var e={};e.id=563,e.ids=[563],e.modules={272:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(818);a.n(n)().config();let o={projectId:("prod"===process.env.ENV?process.env.KONTENT_PROD_PROJECT_ID:process.env.KONTENT_DEV_PROJECT_ID)||"",apiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_MANAGEMENT_API_KEY:process.env.KONTENT_DEV_MANAGEMENT_API_KEY)||"",deliveryApiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_API_KEY:process.env.KONTENT_DEV_DELIVERY_API_KEY)||"",baseUrl:("prod"===process.env.ENV?process.env.KONTENT_PROD_BASE_URL:process.env.KONTENT_DEV_BASE_URL)||"",_DELIVERY_BASE_URL:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_BASE_URL:process.env.KONTENT_DEV_DELIVERY_BASE_URL)||"https://deliver.kontent.ai",contentTypeCodename:process.env.CONTENT_TYPE_CODENAME||""};function r(){return a(9021).appendFileSync("debug.txt",`Using config: ${JSON.stringify(o)}
`),o}},818:e=>{e.exports=require("dotenv")},1428:e=>{e.exports=import("axios")},1824:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>u});var o=a(3480),r=a(8667),i=a(6435),s=a(9152),d=e([s]);s=(d.then?(await d)():d)[0];let c=(0,i.M)(s,"default"),l=(0,i.M)(s,"config"),u=new o.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/uploadpicklist",pathname:"/api/uploadpicklist",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},3480:(e,t,a)=>{e.exports=a(5600)},4524:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{M:()=>b});var o=a(9021),r=a.n(o),i=a(7048),s=a.n(i),d=a(1428),c=a(818),l=a.n(c),u=a(272),p=e([d]);d=(p.then?(await p)():p)[0],l().config();let T=process.env.KONTENT_DEV_PROJECT_ID||"",N=process.env.KONTENT_PROD_PROJECT_ID||"",P=(0,u.A)(),O={default:{codename:"default",id:"00000000-0000-0000-0000-000000000000"},"de-DE":{codename:"de-DE",id:"79228548-6576-5a60-acad-53360bf23687"},"ja-JP":{codename:"ja-JP",id:"4e8fa49a-27d3-44a7-8135-3dc21008ddd1"},"ko-KR":{codename:"ko-KR",id:"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812"},"zh-HK":{codename:"zh-HK",id:"e832b221-cbe7-442a-8edf-98a7ac7afac6"},"zh-TW":{codename:"zh-TW",id:"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed"},"ar-AE":{codename:"ar-AE",id:"3dc9c67d-95d8-4594-890d-70f98c615fbd"},"es-MX":{codename:"es-MX",id:"0814121f-7011-4361-b7bd-cebd74fe4cd9"}};async function g(e,t){try{console.info(`${P.baseUrl}/${P.projectId}/items/codename/${e}/variants/codename/${t}`);let a=await d.default.get(`${P.baseUrl}/${P.projectId}/items/codename/${e}/variants/codename/${t}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.debug(`Found language variant for language ${t} of content item ${e}. Response: ${JSON.stringify(a.data)}`),a.data}catch(a){if(a.response?.status===404)return console.debug(`Language variant for language ${t} of content item ${e} not found. This is expected if the variant does not exist.`),null;throw console.error(`Error finding language variant for language ${t} of content item ${e}: ${a}`),a}}async function f(e,t){try{console.debug(`Creating new version of language variant for language ${t} of item ${e}`);let a=await d.default.put(`${P.baseUrl}/${P.projectId}/items/${e}/variants/codename/${t}/new-version`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Created new version of language variant for language ${t} of item ${e}`),a.data}catch(a){throw console.error(`Error creating new version of language variant for language ${t} of item ${e}: ${a}`),a}}async function $(e,t,a){try{let n=O[t];console.debug(`Updating language variant. ${P.baseUrl}/${P.projectId}/items/${e}/variants/${n?.id}`);let o={elements:a};console.info(`Updating language variant for language ${t} of item ${e} with elements: ${JSON.stringify(o)}`);let r=await d.default.put(`${P.baseUrl}/${P.projectId}/items/${e}/variants/${n?.id}`,o,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Updated language variant for language ${t} of item ${e}`),r.data}catch(a){throw console.error(`Error updating language variant for language ${t} of item ${e}: ${a}`),a}}async function m(e){try{let t=await d.default.get(`${P.baseUrl}/${P.projectId}/items/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Found content item with codename ${e} and id: ${t.data.id}`),t.data}catch(t){throw console.error(`Error finding content item with codename ${e}: ${t}`),t}}async function E(e,t){try{let a=await d.default.post(`${P.baseUrl}/${P.projectId}/items`,{name:e,codename:t,type:{codename:P.contentTypeCodename}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Created content item ${t} with id: ${a.data.id}`),a.data}catch(e){throw d.default.isAxiosError(e)?console.error(`Error creating content item ${t}: ${e.message} Status: ${e.response?.status} Response: ${JSON.stringify(e.response?.data,null,2)}`):console.error(`Error creating content item ${t}: ${e}`),e}}async function h(e,t,a){try{let n=O[t];console.debug(`Adding language variant for language ${n?.id} to item ${e} with elements: ${JSON.stringify(a)}`);let o=await d.default.put(`${P.baseUrl}/${P.projectId}/items/${e}/variants/${n?.id}`,{elements:a},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Added language variant for language ${t} to item ${e}`),o.data}catch(a){throw d.default.isAxiosError(a)?console.error(`Error adding language variant for language ${t} to item ${e}: ${a.message} Status: ${a.response?.status} Response: ${JSON.stringify(a.response?.data,null,2)}`):console.error(`Error adding language variant for language ${t} to item ${e}: ${a}`),a}}async function v(){try{let{data:e}=await d.default.get(`${P.baseUrl}/${P.projectId}/workflows`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}}),t=e.filter(e=>"default"===e.codename)[0].steps.filter(e=>"review"===e.codename);return t[0]?.id}catch(e){throw console.error(`Error fetching review step id: ${e}`),e}}async function y(e,t,a){try{let n=await d.default.put(`${P.baseUrl}/${P.projectId}/items/${e}/variants/codename/${t}/change-workflow`,{workflow_identifier:{codename:"default"},step_identifier:{id:a}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Transitioned language variant for language ${t} of item ${e} to review step`),n.data}catch(a){throw console.error(`Error transitioning language variant for language ${t} of item ${e} to review step: ${a}`),a}}async function w(e,t){try{let a=await d.default.put(`${P.baseUrl}/${P.projectId}/items/${e}/variants/codename/${t}/publish`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.apiKey}`}});return console.info(`Published language variant for language ${t} of item ${e}`),a.data}catch(a){throw d.default.isAxiosError(a)?console.error(`Error publishing language variant for language ${t} of item ${e}: ${a.message} Status: ${a.response?.status} Response: ${JSON.stringify(a.response?.data,null,2)}`):console.error(`Error publishing language variant for language ${t} of item ${e}: ${a}`),a}}function _(e,t){return[{element:{codename:"title"},value:e[t]||e.default||""}]}function A(e){return Object.values(e).some(e=>{let t=e?.value;return Array.isArray(t)?t.length>0:"string"==typeof t&&t.trim().length>0})}async function b(e,t,a){console.info(`Processing CSV file: ${e}`);let n=[],o=Object.keys(O);P.projectId="prod"===t?N:T,P.contentTypeCodename=a;let i=0,d=[];return new Promise((c,l)=>{r().createReadStream(e).pipe(s()({headers:o})).on("data",e=>n.push(e)).on("end",async()=>{try{for(let e=1;e<n.length;e++){let r=n[e];for(let[e,n]of(console.debug(`Available languages in row: ${Object.keys(r).join(", ")}`),Object.entries(r))){if(!n?.trim())continue;let s=e.trim();if("codename"!==s)if(console.debug(`Checking language ${s} with value: ${n.trim()}`),n&&""!==n.trim()){console.debug(`Processing content item for language ${s} with value: ${n.trim()}`);let e=n.trim(),l=`${a}_${e.trim().toLowerCase().replace(/[\/]/g,"_").replace(/\+/g,"_").replace(/[-\s&]+/g,"_").replace(/[^a-z0-9_]/g,"")}`,u=await m(l);if(null==u&&void 0==u){console.debug(`Content item with codename ${l} does not exist. Response: ${JSON.stringify(u)}`);let a=await E(e,l),n=null;for(let e of("prod"===t&&(n=await v(),console.debug(`Review step id: ${n}`)),o)){let o=O[e];if(!o?.id||"codename"===o.codename)continue;let s=_(r,o.codename);await h(a.id,o.id,s),"prod"===t&&await y(a.id,o.id,n),await w(a.id,o.id),i++}}else{console.debug(`Content item with codename ${l} already exists with id: ${u.id}. Response: ${JSON.stringify(u)}`);let e=_(r,s),a=await g(u?.codename,s);null==a||void 0==a?A(e)&&await h(u?.id,s,e):A(e)&&(await f(u?.id,s),await $(u?.id,s,e));let n=null;"prod"===t&&(n=await v(),console.debug(`Review step id: ${n}`)),"prod"===t&&await y(u?.id,s,n),await w(u?.id,s),i++;continue}console.info(`CSV processing completed. Processed: ${i}, Unprocessed: 0 Unprocessed Records: ${JSON.stringify(d)}`),c({processedCount:i,unprocessedCount:0,unprocessedRecords:d})}else console.debug(`No value found for language ${s}`)}}}catch(e){console.error(`Error processing CSV: ${e}`),l(e)}}).on("error",e=>{console.error(`Error reading CSV file: ${e}`),l(e)})})}n()}catch(e){n(e)}})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7048:e=>{e.exports=require("csv-parser")},7313:e=>{e.exports=import("formidable")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")},9152:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>c,default:()=>u});var o=a(7313),r=a(818),i=a.n(r),s=a(4524),d=e([o,s]);[o,s]=d.then?(await d)():d,i().config();let c={api:{bodyParser:!1,externalResolver:!0},runtime:"nodejs"},l=e=>{let t=new o.IncomingForm;return new Promise((a,n)=>{t.parse(e,(e,t,o)=>{if(console.log("\uD83D\uDCE5 Inside form.parse()"),e)return console.error("❌ Error during form parsing:",e),n(e);a({fields:t,files:o})})})},u=async(e,t)=>{if(console.log("Received request method:",e.method),"POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let{files:a,fields:n}=await l(e);if(!a.file)return t.status(400).json({message:"No file uploaded"});let o=Array.isArray(a.file)?a.file[0]:a.file;if(!o.filepath)return t.status(400).json({message:"Invalid file upload"});let r=n.environment,i=n.type,d=o.filepath,c=await (0,s.M)(d,r[0],i[0]);return t.status(200).json({message:"File processed successfully",processedCount:c.processedCount,unprocessedCount:c.unprocessedCount,unprocessedRecords:c.unprocessedRecords})}catch(a){console.error("❌ Error processing upload:",a);let e=a instanceof Error?a.message:"Error processing file";return t.status(500).json({message:e})}};n()}catch(e){n(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=1824);module.exports=a})();