"use strict";(()=>{var e={};e.id=563,e.ids=[563],e.modules={272:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(818);t.n(a)().config();let o={projectId:("prod"===process.env.ENV?process.env.KONTENT_PROD_PROJECT_ID:process.env.KONTENT_DEV_PROJECT_ID)||"",apiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_MANAGEMENT_API_KEY:process.env.KONTENT_DEV_MANAGEMENT_API_KEY)||"",deliveryApiKey:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_API_KEY:process.env.KONTENT_DEV_DELIVERY_API_KEY)||"",baseUrl:("prod"===process.env.ENV?process.env.KONTENT_PROD_BASE_URL:process.env.KONTENT_DEV_BASE_URL)||"",_DELIVERY_BASE_URL:("prod"===process.env.ENV?process.env.KONTENT_PROD_DELIVERY_BASE_URL:process.env.KONTENT_DEV_DELIVERY_BASE_URL)||"https://deliver.kontent.ai",contentTypeCodename:process.env.CONTENT_TYPE_CODENAME||""};function n(){return t(9021).appendFileSync("debug.txt",`Using config: ${JSON.stringify(o)}
`),o}},818:e=>{e.exports=require("dotenv")},1428:e=>{e.exports=import("axios")},1824:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>d,routeModule:()=>p});var o=t(3480),n=t(8667),s=t(6435),i=t(9152),c=e([i]);i=(c.then?(await c)():c)[0];let d=(0,s.M)(i,"default"),l=(0,s.M)(i,"config"),p=new o.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/uploadpicklist",pathname:"/api/uploadpicklist",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},3480:(e,r,t)=>{e.exports=t(5600)},4524:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{M:()=>T});var o=t(9021),n=t.n(o),s=t(7048),i=t.n(s),c=t(1428),d=t(818),l=t.n(d),p=t(272),u=e([c]);c=(u.then?(await u)():u)[0],l().config();let P=process.env.KONTENT_DEV_PROJECT_ID||"",N=process.env.KONTENT_PROD_PROJECT_ID||"",b=(0,p.A)(),j={default:{codename:"default",id:"00000000-0000-0000-0000-000000000000"},"de-DE":{codename:"de-DE",id:"79228548-6576-5a60-acad-53360bf23687"},"ja-JP":{codename:"ja-JP",id:"4e8fa49a-27d3-44a7-8135-3dc21008ddd1"},"ko-KR":{codename:"ko-KR",id:"ce929a3d-f7df-4ab1-a1b5-aaa38a7a4812"},"zh-HK":{codename:"zh-HK",id:"e832b221-cbe7-442a-8edf-98a7ac7afac6"},"zh-TW":{codename:"zh-TW",id:"f0666814-0e42-48c7-a4c9-dea7c1d7b2ed"},"ar-AE":{codename:"ar-AE",id:"3dc9c67d-95d8-4594-890d-70f98c615fbd"},"es-MX":{codename:"es-MX",id:"0814121f-7011-4361-b7bd-cebd74fe4cd9"}};async function f(e,r){try{return(await c.default.get(`${b.baseUrl}/${b.projectId}/items/codename/${e}/variants/codename/${r}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){if(e.response?.status===404)return null;throw e}}async function g(e,r){try{return console.log(`Creating new version of language variant. ${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}/new-version`),(await c.default.put(`${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}/new-version`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw c.default.isAxiosError(e)&&(console.error("Status:",e.response?.status),console.error("Response:",JSON.stringify(e.response?.data,null,2))),e}}async function m(e,r,t){try{return console.log(`Updating language variant. ${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}`),(await c.default.put(`${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}`,{elements:t},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw c.default.isAxiosError(e)&&(console.error("Status:",e.response?.status),console.error("Response:",JSON.stringify(e.response?.data,null,2))),e}}async function E(e){try{return(await c.default.get(`${b.baseUrl}/${b.projectId}/items/codename/${e}`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){if(e.response?.status===404)return null;throw e}}async function $(e,r){try{return(await c.default.post(`${b.baseUrl}/${b.projectId}/items`,{name:e,codename:r,type:{codename:b.contentTypeCodename}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw console.error(`Error creating content item: ${e}`),e}}async function y(e,r,t){try{return console.log(`Adding language variant. ${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}`),(await c.default.put(`${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}`,{elements:t},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw console.error(`Error adding language variant: ${e}`),e}}async function h(){try{let{data:e}=await c.default.get(`${b.baseUrl}/${b.projectId}/workflows`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}}),r=e.filter(e=>"default"===e.codename)[0].steps.filter(e=>"review"===e.codename);return r[0]?.id}catch(e){throw console.error(`Error publishing language variant: ${e}`),e}}async function v(e,r,t){try{return(await c.default.put(`${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}/change-workflow`,{workflow_identifier:{codename:"default"},step_identifier:{id:t}},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw console.error(`Error publishing language variant: ${e}`),e}}async function _(e,r){try{return(await c.default.put(`${b.baseUrl}/${b.projectId}/items/${e}/variants/codename/${r}/publish`,{},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.apiKey}`}})).data}catch(e){throw console.error(`Error publishing language variant: ${e}`),e}}function w(e,r){return[{element:{codename:"title"},value:e[r]||e.default||""}]}function A(e){return Object.values(e).some(e=>{let r=e?.value;return Array.isArray(r)?r.length>0:"string"==typeof r&&r.trim().length>0})}async function T(e,r,t){console.log(`Processing CSV file: ${e}`);let a=[],o=Object.keys(j);b.projectId="prod"===r?N:P,b.contentTypeCodename=t;let s=0,c=[];return new Promise((d,l)=>{n().createReadStream(e).pipe(i()({headers:o})).on("data",e=>a.push(e)).on("end",async()=>{try{for(let e=1;e<a.length;e++){let n=a[e];for(let[a,i]of(console.log(`Processing row ${e}: ${JSON.stringify(n)} `),Object.entries(n))){if(!i?.trim())continue;let e=a.trim();if(i&&""!==i.trim()){console.log(`Found value for language ${e}: ${i.trim()}`);let a=i.trim(),l=`${t}_${a.trim().toLowerCase().replace(/[\/]/g,"_").replace(/\+/g,"_").replace(/[-\s&]+/g,"_").replace(/[^a-z0-9_]/g,"")}`,p=await E(l);if(null==p&&void 0==p){console.log(`Content item ${l} does not exist. Creating new item.`);let e=await $(a,l),t=null;for(let a of("prod"===r&&(t=await h(),console.log("\uD83D\uDE80 ~ .on ~ reviewStepId:",t)),o)){let o=j[a]?.id;if(!o)continue;let i=w(n,o);await y(e.id,o,i),"prod"===r&&await v(e.id,o,t),await _(e.id,o),s++}}else{console.log(`Generated codename for language ${e}: ${l}`);let t=w(n,e);await f(p?.codename,e)?(console.log(`Updating Language variant for ${e}.`),await g(p?.id,e),A(t)&&await m(p?.id,e,t)):A(t)&&await y(p?.id,e,t);let a=null;"prod"===r&&(a=await h(),console.log("\uD83D\uDE80 ~ .on ~ reviewStepId:",a)),"prod"===r&&await v(p?.id,e,a),await _(p?.id,e),s++;continue}console.log(`CSV processing completed. Processed: ${s}, Unprocessed: 0 Unprocessed Records: ${JSON.stringify(c)}`),d({processedCount:s,unprocessedCount:0,unprocessedRecords:c})}else console.log(`No value found for language ${e}`)}}}catch(e){console.error(`Error processing CSV: ${e}`),l(e)}}).on("error",e=>{console.error(`Error reading CSV file: ${e.message}`),l(e)})})}a()}catch(e){a(e)}})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7048:e=>{e.exports=require("csv-parser")},7313:e=>{e.exports=import("formidable")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9021:e=>{e.exports=require("fs")},9152:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>p});var o=t(7313),n=t(818),s=t.n(n),i=t(4524),c=e([o,i]);[o,i]=c.then?(await c)():c,s().config();let d={api:{bodyParser:!1,externalResolver:!0},runtime:"nodejs"},l=e=>{let r=new o.IncomingForm;return new Promise((t,a)=>{r.parse(e,(e,r,o)=>{if(console.log("\uD83D\uDCE5 Inside form.parse()"),e)return console.error("❌ Error during form parsing:",e),a(e);t({fields:r,files:o})})})},p=async(e,r)=>{if(console.log("Received request method:",e.method),"POST"!==e.method)return r.status(405).json({message:"Method Not Allowed"});try{let{files:t,fields:a}=await l(e);if(!t.file)return r.status(400).json({message:"No file uploaded"});let o=Array.isArray(t.file)?t.file[0]:t.file;if(!o.filepath)return r.status(400).json({message:"Invalid file upload"});let n=a.environment,s=a.type,c=o.filepath,d=await (0,i.M)(c,n[0],s[0]);return r.status(200).json({message:"File processed successfully",processedCount:d.processedCount,unprocessedCount:d.unprocessedCount,unprocessedRecords:d.unprocessedRecords})}catch(t){console.error("❌ Error processing upload:",t);let e=t instanceof Error?t.message:"Error processing file";return r.status(500).json({message:e})}};a()}catch(e){a(e)}})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1824);module.exports=t})();